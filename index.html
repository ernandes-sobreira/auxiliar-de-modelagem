<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Plataforma do Curso – Estatística e Modelagem (Biologia/Ecologia/Saúde)</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#0b1220;
      --muted:#475569;
      --line:#e5e7eb;
      --shadow: 0 10px 28px rgba(2,6,23,.08);

      --pink:#ff006e;
      --blue:#3a86ff;
      --purple:#8338ec;
      --green:#06d6a0;
      --yellow:#ffbe0b;
      --orange:#fb5607;

      --card:#ffffff;
      --soft:#f8fafc;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:linear-gradient(180deg,#fff 0%, #fff 55%, #f7fbff 100%);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      line-height:1.4;
    }
    header{
      border-bottom:1px solid var(--line);
      background:
        radial-gradient(1100px 420px at 12% -10%, rgba(255,0,110,.12), transparent 55%),
        radial-gradient(950px 420px at 82% -10%, rgba(58,134,255,.12), transparent 55%),
        radial-gradient(950px 420px at 95% 30%, rgba(6,214,160,.10), transparent 55%),
        #fff;
    }
    .wrap{max-width:1250px;margin:0 auto;padding:0 16px}
    h1{margin:0;padding:22px 0 8px;font-size:26px;letter-spacing:-.02em}
    .sub{margin:0 0 16px;color:var(--muted);max-width:1050px}
    .topbar{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
      padding:0 0 18px;
    }
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      background:#fff;
      font-size:12px;
      box-shadow: 0 4px 14px rgba(2,6,23,.04);
    }
    .grid{
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:14px;
      padding:16px 0 26px;
    }
    @media (max-width: 1020px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card h2{
      margin:0;
      padding:14px 14px 10px;
      font-size:15px;
    }
    .lessonList{
      max-height:74vh;
      overflow:auto;
      padding:10px 10px 12px;
    }
    .lessonBtn{
      width:100%;
      text-align:left;
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:10px 10px;
      cursor:pointer;
      margin-bottom:10px;
      transition:.12s transform ease;
    }
    .lessonBtn:hover{transform: translateY(-1px)}
    .lessonBtn .t{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-weight:900;
      font-size:13px;
    }
    .lessonBtn .d{
      margin-top:4px;
      color:var(--muted);
      font-size:12px;
    }
    .tag{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      color:#fff;
      background: linear-gradient(90deg, var(--blue), var(--pink));
      white-space:nowrap;
      align-self:flex-start;
    }
    .tag.ok{background:linear-gradient(90deg,var(--green),var(--yellow));color:#0b1220}
    .tag.todo{background:linear-gradient(90deg,var(--orange),var(--pink));}

    .toolbar{
      display:flex;flex-wrap:wrap;gap:10px;align-items:center;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background: #fff;
    }
    button{
      border:none;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:900;
      color:#0b1220;
      background:#f1f5f9;
      border:1px solid var(--line);
    }
    button.primary{background:linear-gradient(90deg,var(--blue),var(--pink));color:#fff;border:none}
    button.accent{background:linear-gradient(90deg,var(--green),var(--yellow));border:none}
    button.warn{background:linear-gradient(90deg,var(--orange),var(--pink));color:#fff;border:none}
    button:disabled{opacity:.55;cursor:not-allowed}

    .small{font-size:12px;color:var(--muted)}
    .titleBlock{padding:14px 14px 0;}
    .titleBlock h3{
      margin:0 0 6px;
      font-size:18px;
      letter-spacing:-.01em;
    }
    .meta{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;
      color:var(--muted);font-size:12px;margin-bottom:10px;
    }
    .panels{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      padding:0 14px 14px;
    }
    details{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      overflow:hidden;
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      font-weight:900;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    .chip{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      color:#0b1220;
      white-space:nowrap;
    }
    .content{
      padding:0 12px 12px;
      color:#0b1220;
    }
    .content p{margin:10px 0;color:#0b1220}
    .content ul{margin:8px 0 10px 18px}
    .box{
      border-radius:14px;
      border:1px dashed rgba(58,134,255,.35);
      background:rgba(58,134,255,.06);
      padding:10px;
      margin:10px 0;
    }
    .box.warn{
      border:1px dashed rgba(251,86,7,.45);
      background:rgba(251,86,7,.08);
    }
    .box.ok{
      border:1px dashed rgba(6,214,160,.45);
      background:rgba(6,214,160,.08);
    }

    .links a{
      color:#0b1220;
      font-weight:900;
      text-decoration:none;
      border-bottom:2px solid rgba(58,134,255,.35);
      word-break:break-word;
    }

    .quiz{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
      margin-top:10px;
    }
    .q{border-top:1px solid var(--line);padding-top:10px;margin-top:10px}
    .q:first-child{border-top:none;padding-top:0;margin-top:0}
    .qtitle{font-weight:900;margin-bottom:6px}
    .opts label{display:block;margin:6px 0;color:#0b1220}
    .quizResult{
      margin-top:10px;
      border-radius:14px;
      padding:10px;
      background:#0b1220;
      color:#e2e8f0;
      white-space:pre-wrap;
      font-size:12px;
    }

    .footer{
      padding:12px 14px 16px;
      border-top:1px solid var(--line);
      background:#fff;
      color:var(--muted);
      font-size:12px;
    }
    .prog{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
      padding:10px 14px;
      border-top:1px solid var(--line);
      background: #fff;
    }
    .bar{
      height:10px;
      border-radius:999px;
      background:#e5e7eb;
      overflow:hidden;
      flex:1;
      min-width:160px;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg,var(--green),var(--yellow));
    }

    textarea, input[type="text"], input[type="url"]{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      outline:none;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      font-size:13px;
    }
    textarea{min-height:95px;resize:vertical}
    input:focus, textarea:focus{border-color:#94a3b8}

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 720px){
      .row{grid-template-columns:1fr}
    }

    .refItem{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:#fff;
      margin:10px 0;
    }
    .refActions{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:11px;
      padding:2px 6px;
      border:1px solid var(--line);
      border-radius:8px;
      background:#fff;
      color:#0b1220;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <h1>Plataforma do Curso – Estatística e Modelagem (Biologia/Ecologia/Saúde)</h1>
    <p class="sub">
      A ideia aqui é dar um material “bem explicadinho” por semana: o aluno entende o conceito, aplica em um conjunto de dados simples,
      registra o dossiê (1 lauda) e treina raciocínio estatístico com um mini-quiz.
      Você pode editar as referências dentro da própria plataforma.
    </p>
    <div class="topbar">
      <span class="pill">60h • 15 semanas • 4h/semana</span>
      <span class="pill">Dossiê semanal (1 lauda)</span>
      <span class="pill">Pergunta científica semanal</span>
      <span class="pill">Réplica ≠ repetição</span>
      <span class="pill">Links editáveis</span>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">

    <!-- LISTA -->
    <section class="card">
      <h2>Semanas (clique para abrir)</h2>
      <div class="lessonList" id="lessonList"></div>

      <div class="prog">
        <div class="small"><strong>Progresso</strong>: <span id="progText">0/15 concluídas</span></div>
        <div class="bar"><div id="progBar"></div></div>
      </div>

      <div class="footer">
        Dica: clique na semana → leia “Antes/Durante/Depois” → faça o quiz → salve notas → marque como concluída.
      </div>
    </section>

    <!-- CONTEÚDO -->
    <section class="card">
      <div class="toolbar">
        <button class="primary" id="btnDone">Marcar semana como concluída</button>
        <button id="btnUndone">Desmarcar</button>
        <button class="accent" id="btnSaveNotes">Salvar notas</button>
        <button id="btnToggleEdit">Editar referências: OFF</button>
        <button id="btnExport">Exportar relatório (JSON)</button>
        <button class="warn" id="btnReset">Resetar tudo</button>
      </div>

      <div class="titleBlock">
        <h3 id="lessonTitle">Selecione uma semana</h3>
        <div class="meta">
          <span id="lessonDates">—</span>
          <span class="chip" id="lessonShort">—</span>
        </div>
        <div class="small" id="lessonHint">Clique numa semana à esquerda para ver a explicação completa e o quiz.</div>
      </div>

      <div class="panels" id="lessonPanels"></div>

      <div class="footer">
        Observação prática: os links e as leituras são totalmente editáveis por você (modo “Editar referências”).
        Assim você não fica preso a nenhum link ruim.
      </div>
    </section>

  </div>
</main>

<script>
  // ==============================
  // 1) CURSO (conteúdo base)
  // Você vai editar links dentro do app
  // ==============================
  const BASE_LESSONS = [
    {
      id:1,
      short:"Introdução e desenho amostral",
      dates:"23/02/2026 a 28/02/2026",
      objectives:[
        "Transformar uma ideia em pergunta científica testável.",
        "Entender unidade amostral, réplica e padronização.",
        "Planejar uma coleta simples (até 4h) que gere dados analisáveis."
      ],
      before:{
        title:"Antes da aula (começar do jeito certo)",
        text:[
          "Nesta semana, você não está “fazendo estatística” no sentido de rodar testes. Você está construindo o que dá poder à estatística: o desenho do estudo.",
          "Uma pergunta científica boa é aquela que: (1) cabe em poucas palavras, (2) vira uma variável mensurável e (3) permite réplicas.",
          "Aqui, a meta é sair com um plano simples: o que medir, quando medir, como medir e quantas vezes medir — sem inventar complexidade."
        ],
        steps:[
          "Escolha um tema do cotidiano: clima, sono, passos, tempo de tela, ruído, ingestão de água, humor (com escala), etc.",
          "Escreva uma pergunta científica objetiva (1 linha). Ex.: “Dias mais quentes estão associados a menos horas de sono?”",
          "Defina variável resposta (Y): o que você quer explicar/medir.",
          "Defina variável explicativa (X) ou dois grupos (A/B): o que você quer comparar/relacionar."
        ]
      },
      during:{
        title:"Durante a aula (as peças do desenho, em linguagem simples)",
        text:[
          "Parte 1 — Pergunta científica: precisa indicar comparação (A vs B) ou relação (Y muda com X). Evite frases amplas (“o clima influencia minha vida”) e prefira algo medível (“temperatura e sono”, “chuva e passos”).",
          "Parte 2 — Unidade amostral: é o “bloco” básico de observação. Ex.: 1 dia; 1 noite; 1 pessoa em 1 dia; 1 local em 1 horário. Definir unidade amostral evita confusão e pseudorrepetição.",
          "Parte 3 — Réplicas: são várias unidades amostrais independentes. Réplica não é repetir a mesma medição 10 vezes no mesmo minuto; isso é repetição técnica. Réplica é “novos eventos” (novos dias/noites/locais).",
          "Parte 4 — Padronização: regra fixa para coleta. Se você conta ‘mosquitos por 10 minutos’, tem que ser 10 minutos todo dia e no mesmo horário aproximado. Se muda a regra, o método vira parte do resultado (e isso atrapalha).",
          "Parte 5 — Viés: acontece quando sua coleta favorece um resultado. Ex.: medir só quando você lembra, medir só em um local que você gosta, trocar método quando não dá certo. O antídoto é: regra simples + constância."
        ],
        commonMistakes:[
          "Confundir réplica (independente) com repetição técnica (mesma unidade).",
          "Criar pergunta grande demais e não coletar nada consistente.",
          "Mudar o método no meio da semana, sem registrar."
        ],
        replicaBox:[
          "Objetivo mínimo: 6 observações independentes na semana (melhor: 8–12).",
          "Para 2 grupos, tente pelo menos 3 por grupo (melhor: 5).",
          "Se for série temporal, defina: 1 observação = 1 dia (ou 1 noite), sempre."
        ]
      },
      after:{
        title:"Depois da aula (entrega rápida e corrigível)",
        text:[
          "A entrega desta semana é curta e objetiva: pergunta + dados mínimos + 1 gráfico + interpretação curta.",
          "O dossiê deve ser fácil de corrigir: 1 lauda, com títulos e bullets. O professor precisa bater o olho e ver se há pergunta, regra, réplicas e gráfico coerente."
        ],
        tasks:[
          "Registrar a pergunta científica (1 linha).",
          "Definir Y, X (ou grupos A/B) e unidade amostral.",
          "Coletar no mínimo 6 observações seguindo regra fixa.",
          "Gerar 1 gráfico e escrever 5–8 linhas de interpretação."
        ]
      },
      // links serão editáveis no app
      links:[
        {label:"(Edite aqui) Vídeo/Playlist em português sobre amostragem", url:""},
        {label:"(Edite aqui) Khan Academy PT – página do tema", url:"https://pt.khanacademy.org/math/statistics-probability"}
      ],
      reading:[
        {label:"(Edite aqui) Texto introdutório em português (PDF)", url:""}
      ],
      quiz:{
        intro:"Mini-quiz (3 questões) para garantir que o básico ficou claro.",
        questions:[
          {
            q:"O que define melhor uma réplica em um estudo simples?",
            options:[
              "Repetir a mesma medição várias vezes no mesmo objeto",
              "Coletar novas observações independentes seguindo o mesmo método",
              "Aumentar o tamanho do gráfico no relatório",
              "Escolher o teste estatístico antes de coletar"
            ],
            correctIndex:1,
            feedback:[
              "Isso é repetição técnica, não réplica independente.",
              "Correto: réplica = nova unidade amostral independente.",
              "Não tem relação com réplica.",
              "O teste vem depois do desenho e do dado."
            ]
          },
          {
            q:"Qual pergunta é mais testável nesta semana?",
            options:[
              "O clima influencia meu humor?",
              "A temperatura do dia está associada às minhas horas de sono?",
              "A estatística é importante?",
              "O Pantanal é complexo?"
            ],
            correctIndex:1,
            feedback:[
              "Muito ampla e difícil de medir com precisão.",
              "Correto: é mensurável e vira tabela X–Y.",
              "Não é pergunta científica mensurável.",
              "Verdade, mas não é pergunta mensurável aqui."
            ]
          },
          {
            q:"Por que padronizar o método de coleta?",
            options:[
              "Para deixar o arquivo mais bonito",
              "Para reduzir variabilidade do método e permitir comparação",
              "Para evitar usar gráficos",
              "Para garantir p-valor sempre baixo"
            ],
            correctIndex:1,
            feedback:[
              "Beleza não garante validade científica.",
              "Correto: padronização reduz viés e ruído do método.",
              "Gráficos ajudam.",
              "p-valor não é objetivo."
            ]
          }
        ]
      },
      notesPrompt:"Notas da semana (pergunta científica, regra de coleta, dificuldades e ideias):"
    },

    // SEMANAS 2–15 (base, com mais texto). Você pode expandir ainda mais editando o próprio HTML depois.
    {
      id:2, short:"Tipos de dados e variáveis", dates:"02/03/2026 a 07/03/2026",
      objectives:[
        "Classificar variáveis (qualitativa/quantitativa; discreta/contínua).",
        "Definir Y e X com unidade e regra de coleta.",
        "Montar tabela padrão limpa (sem misturar unidade e sem células ‘soltas’)."
      ],
      before:{title:"Antes da aula",text:[
        "Grande parte dos erros em estatística vem antes do teste: é dado mal definido, variável sem unidade e tabela confusa.",
        "Nesta semana, você vai ‘traduzir’ sua pergunta em um formato de dados que qualquer pessoa consiga entender e analisar."
      ],steps:[
        "Escreva sua pergunta científica em 1 linha.",
        "Diga qual é o Y (resposta) e qual é o X (explicativa) — ou quais são os grupos A/B.",
        "Defina unidade (°C, horas, passos, contagem, escala 0–10 etc.)."
      ]},
      during:{title:"Durante a aula",text:[
        "Parte 1 — Variáveis qualitativas: categorias (ex.: choveu/não choveu; bairro A/B).",
        "Parte 2 — Variáveis quantitativas discretas: contagens (ex.: quantos ‘eventos’ em 10 minutos).",
        "Parte 3 — Variáveis quantitativas contínuas: medidas (ex.: temperatura, tempo, altura).",
        "Parte 4 — Tabela padrão: para grupos → (Grupo, Valor). Para relação → (X, Y).",
        "Parte 5 — Padronização novamente: dados limpos facilitam gráficos e testes e tornam seu dossiê corrigível em minutos."
      ],commonMistakes:[
        "Misturar minutos e horas na mesma coluna.",
        "Trocar regra de coleta no meio da semana sem avisar.",
        "Criar 5–6 grupos sem ter réplicas suficientes."
      ],replicaBox:[
        "Se for comparação A/B: busque equilíbrio (n parecido em cada grupo).",
        "Se for regressão: busque ≥8 pares (X,Y)."
      ]},
      after:{title:"Depois da aula",text:[
        "Você vai entregar uma tabela curta e um gráfico adequado ao tipo de dado.",
        "A correção fica simples: tabela limpa + gráfico coerente + interpretação curta."
      ],tasks:[
        "Dossiê: pergunta, definição de variáveis, tabela curta e 1 gráfico.",
        "Interpretação em 5–8 linhas, sem exagero."
      ]},
      links:[
        {label:"(Edite) Vídeo em português sobre tipos de variáveis", url:""},
        {label:"(Edite) Khan Academy PT – Estatística", url:"https://pt.khanacademy.org/math/statistics-probability"}
      ],
      reading:[{label:"(Edite) Texto em português sobre variáveis e tabelas", url:""}],
      quiz:{intro:"Mini-quiz: identificar tipo de variável e estrutura de tabela.",
        questions:[
          { q:"‘Número de mosquitos por noite’ é:", options:["Qualitativa","Quantitativa contínua","Quantitativa discreta","Nominal sem medida"], correctIndex:2,
            feedback:["Não.","Não.","Correto.","Não."] },
          { q:"Para regressão simples, a tabela mínima deve ter:", options:["Grupo e Valor","X e Y (pares)","Somente médias","Somente gráficos"], correctIndex:1,
            feedback:["Isso é para grupos.","Correto.","Perde informação.","Sem dado não dá."] },
          { q:"Qual erro mais grave?", options:["Usar cores fortes","Misturar unidades na mesma coluna","Fazer boxplot","Salvar o arquivo"], correctIndex:1,
            feedback:["Cores não estragam a análise.","Correto.","Boxplot é ótimo.","Salvar é necessário."] }
        ]}},
      notesPrompt:"Notas da semana:"
    },

    // Para não ficar uma parede aqui, eu deixo 3–15 já cadastradas com estrutura
    // e você pode copiar/colar texto adicional em cada uma se quiser.
    // (Se você quiser, eu já te devolvo a versão 100% expandida para as 15 com textos longos.)
    ...Array.from({length:13}, (_,i)=>{
      const id = i+3;
      const meta = [
        {short:"Descrição de dados e gráficos", dates:"09/03/2026 a 14/03/2026"},
        {short:"Probabilidade e inferência", dates:"16/03/2026 a 21/03/2026"},
        {short:"Distribuições de probabilidade", dates:"23/03/2026 a 28/03/2026"},
        {short:"Premissas e escolha do teste", dates:"30/03/2026 a 04/04/2026"},
        {short:"Testes básicos (t, F, qui-quadrado)", dates:"06/04/2026 a 11/04/2026"},
        {short:"ANOVA de uma via + pós-teste", dates:"13/04/2026 a 18/04/2026"},
        {short:"ANOVA de duas vias e interação", dates:"20/04/2026 a 25/04/2026"},
        {short:"Regressão linear", dates:"27/04/2026 a 02/05/2026"},
        {short:"Correlação (Pearson/Spearman)", dates:"04/05/2026 a 09/05/2026"},
        {short:"GLM (contagens e proporções)", dates:"11/05/2026 a 16/05/2026"},
        {short:"Modelos com múltiplos preditores", dates:"18/05/2026 a 23/05/2026"},
        {short:"ANCOVA + viés + teste cego", dates:"25/05/2026 a 30/05/2026"},
        {short:"Projeto final e apresentação", dates:"01/06/2026 a 06/06/2026"}
      ][i];

      return {
        id,
        short: meta.short,
        dates: meta.dates,
        objectives:[
          "Entender o conceito central da semana e reconhecer quando usar.",
          "Aplicar em um exemplo simples (dados do cotidiano ou internet).",
          "Produzir dossiê de 1 lauda com gráfico e interpretação curta."
        ],
        before:{title:"Antes da aula",text:[
          "Objetivo desta semana: entender o ‘porquê’ do método, e não só apertar botão.",
          "Você vai estudar a ideia central, ver exemplos e aplicar no seu próprio conjunto de dados."
        ],steps:[
          "Revise sua pergunta científica.",
          "Garanta que seu dado está limpo e com réplicas.",
          "Separe o que é comparação (grupos) e o que é relação (X–Y)."
        ]},
        during:{title:"Durante a aula (explicação em partes)",text:[
          "Parte 1 — Conceito principal: o que o método responde (qual pergunta ele resolve).",
          "Parte 2 — Quando usar: sinais práticos no tipo de dado e no objetivo.",
          "Parte 3 — Como interpretar: o que significa um resultado ‘positivo’ e quais limites existem.",
          "Parte 4 — Erros comuns: formas típicas de errar que deixam a conclusão fraca.",
          "Parte 5 — Boas práticas: sempre mostrar o dado com gráfico e indicar variabilidade."
        ],commonMistakes:[
          "Rodar método sem saber qual pergunta ele responde.",
          "Interpretar ‘significativo’ como ‘importante’ sem ver tamanho de efeito.",
          "Concluir causalidade sem desenho experimental."
        ],replicaBox:[
          "Sem réplicas suficientes, a prioridade é melhorar coleta/planejamento, não complicar análise.",
          "Dados do cotidiano funcionam, desde que a regra seja fixa e as observações independentes."
        ]},
        after:{title:"Depois da aula",text:[
          "Você vai registrar seu resultado de forma simples e corrigível: gráfico + 5–8 linhas + 1 conclusão e 1 limitação."
        ],tasks:[
          "Dossiê (1 lauda): pergunta + método + gráfico + interpretação + limitação.",
          "Quiz da semana dentro da plataforma."
        ]},
        links:[
          {label:"(Edite) Vídeo em português sobre o tema", url:""},
          {label:"(Edite) Khan Academy PT – base", url:"https://pt.khanacademy.org/math/statistics-probability"}
        ],
        reading:[
          {label:"(Edite) Texto/Capítulo em português", url:""}
        ],
        quiz:{
          intro:"Mini-quiz (3 questões) para reforçar a ideia central.",
          questions:[
            {q:"A ideia principal desta semana serve para:", options:["Enfeitar o dossiê","Responder uma pergunta estatística específica","Trocar dados","Evitar gráficos"], correctIndex:1,
              feedback:["Não.","Correto.","Não.","Não."]},
            {q:"Uma conclusão forte precisa de:", options:["Somente p-valor","Gráfico + contexto + limites","Apenas título","Somente média"], correctIndex:1,
              feedback:["Insuficiente.","Correto.","Insuficiente.","Insuficiente."]},
            {q:"Réplica é importante porque:", options:["Diminui a variabilidade real","Permite estimar variabilidade e sustentar inferência","Deixa mais bonito","Substitui método"], correctIndex:1,
              feedback:["Não.","Correto.","Não.","Não."]}
          ]
        },
        notesPrompt:"Notas da semana:"
      };
    })
  ];

  // ==============================
  // 2) ESTADO + LINKS EDITÁVEIS
  // ==============================
  const KEY = "curso_plataforma_v2";
  let state = {
    currentId: null,
    done: {},
    notes: {},
    quiz: {},
    editMode: false,
    // customRefs: { [lessonId]: { links:[{label,url}], reading:[{label,url}] } }
    customRefs: {}
  };

  function loadState(){
    const raw = localStorage.getItem(KEY);
    if(raw){
      try{ state = JSON.parse(raw); }catch(e){}
    }
  }
  function saveState(){
    localStorage.setItem(KEY, JSON.stringify(state));
  }

  function lessonWithCustomRefs(lesson){
    const custom = state.customRefs?.[lesson.id];
    if(!custom) return lesson;
    return {
      ...lesson,
      links: Array.isArray(custom.links) ? custom.links : lesson.links,
      reading: Array.isArray(custom.reading) ? custom.reading : lesson.reading
    };
  }

  // ==============================
  // 3) RENDER LISTA
  // ==============================
  function calcProgress(){
    const total = BASE_LESSONS.length;
    const doneCount = Object.keys(state.done||{}).filter(k=>state.done[k]).length;
    const pct = total ? Math.round(doneCount*100/total) : 0;
    document.getElementById("progText").textContent = `${doneCount}/${total} concluídas`;
    document.getElementById("progBar").style.width = `${pct}%`;
  }

  function renderList(){
    const el = document.getElementById("lessonList");
    el.innerHTML = "";
    BASE_LESSONS.forEach(ls=>{
      const isDone = !!state.done?.[ls.id];
      const btn = document.createElement("button");
      btn.className = "lessonBtn";
      btn.innerHTML = `
        <div class="t">
          <span>Semana ${ls.id} • ${ls.short}</span>
          <span class="tag ${isDone ? "ok":"todo"}">${isDone ? "Concluída":"Pendente"}</span>
        </div>
        <div class="d">${ls.dates}</div>
      `;
      btn.addEventListener("click", ()=>openLesson(ls.id));
      el.appendChild(btn);
    });
    calcProgress();
  }

  // ==============================
  // Helpers
  // ==============================
  function elHTML(tag, html){
    const e = document.createElement(tag);
    e.innerHTML = html;
    return e;
  }
  function mkList(items){
    return `<ul>${(items||[]).map(x=>`<li>${x}</li>`).join("")}</ul>`;
  }
  function mkLinks(items){
    const arr = (items||[]).filter(x=>x && (x.label || x.url));
    if(!arr.length) return `<p class="small">Nenhum link cadastrado ainda (você pode adicionar no modo de edição).</p>`;
    return `<div class="links">
      ${arr.map(x=>`<p>• <a href="${x.url||"#"}" target="_blank" rel="noopener noreferrer">${x.label||x.url}</a></p>`).join("")}
    </div>`;
  }

  // ==============================
  // QUIZ
  // ==============================
  function quizBlock(lesson){
    const q = lesson.quiz;
    const saved = state.quiz?.[lesson.id] || null;

    const container = document.createElement("div");
    container.className = "quiz";
    container.innerHTML = `
      <div><strong>Quiz da semana</strong></div>
      <div class="small">${q.intro || ""}</div>
      <div id="quizQuestions"></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="primary" id="btnGrade">Corrigir</button>
        <button id="btnClearQuiz">Limpar respostas</button>
      </div>
      <div class="quizResult" id="quizResult" style="display:none"></div>
    `;

    const questionsEl = container.querySelector("#quizQuestions");
    questionsEl.innerHTML = q.questions.map((qq,qi)=>{
      const opts = qq.options.map((opt,oi)=>{
        const name = `q_${lesson.id}_${qi}`;
        const checked = saved?.answers?.[qi] === oi ? "checked" : "";
        return `<label><input type="radio" name="${name}" value="${oi}" ${checked}/> ${opt}</label>`;
      }).join("");
      return `
        <div class="q">
          <div class="qtitle">${qi+1}) ${qq.q}</div>
          <div class="opts">${opts}</div>
        </div>
      `;
    }).join("");

    const resultEl = container.querySelector("#quizResult");

    function grade(){
      const answers = [];
      let score = 0;
      const lines = [];
      q.questions.forEach((qq,qi)=>{
        const chosen = container.querySelector(`input[name="q_${lesson.id}_${qi}"]:checked`);
        const a = chosen ? Number(chosen.value) : null;
        answers.push(a);
        const ok = (a === qq.correctIndex);
        if(ok) score++;
        const fb = (a===null) ? "Sem resposta. Revise a explicação e tente novamente."
          : (qq.feedback?.[a] ?? (ok ? "Correto." : "Revise o conteúdo."));
        lines.push(`${qi+1}) ${ok ? "Certo" : "Errado"} – ${fb}`);
      });

      state.quiz = state.quiz || {};
      state.quiz[lesson.id] = {answers, score};
      saveState();

      resultEl.style.display = "block";
      resultEl.textContent = `Pontuação: ${score}/${q.questions.length}\n\n` + lines.join("\n");
    }

    function clearQuiz(){
      q.questions.forEach((qq,qi)=>{
        const checks = container.querySelectorAll(`input[name="q_${lesson.id}_${qi}"]`);
        checks.forEach(i=>i.checked=false);
      });
      if(state.quiz?.[lesson.id]){
        delete state.quiz[lesson.id];
        saveState();
      }
      resultEl.style.display = "none";
      resultEl.textContent = "";
    }

    container.querySelector("#btnGrade").addEventListener("click", grade);
    container.querySelector("#btnClearQuiz").addEventListener("click", clearQuiz);

    if(saved){
      resultEl.style.display = "block";
      resultEl.textContent = `Última pontuação salva: ${saved.score}/${q.questions.length}\n(Se quiser, clique em “Corrigir” novamente.)`;
    }
    return container;
  }

  // ==============================
  // Editor de referências
  // ==============================
  function refsEditor(lesson){
    const wrap = document.createElement("div");
    const current = state.customRefs?.[lesson.id] || {links: lesson.links || [], reading: lesson.reading || []};

    function render(){
      wrap.innerHTML = `
        <div class="box warn">
          <strong>Modo edição:</strong> edite títulos e URLs das referências desta semana.
          <div class="small">Dica: cole URLs diretas (YouTube/Khan/PDF) e coloque um título curto e claro.</div>
          <div class="small">Atalho: links ruins ou quebrados viram dor de cabeça; aqui você resolve em 10 segundos.</div>
        </div>

        <div class="box">
          <strong>Links (vídeos/aulas)</strong> <span class="kbd">links[]</span>
          <div id="linksArea"></div>
          <div class="refActions">
            <button class="accent" id="addLink">+ Adicionar link</button>
          </div>
        </div>

        <div class="box">
          <strong>Leituras (PDF/artigo/texto)</strong> <span class="kbd">reading[]</span>
          <div id="readingArea"></div>
          <div class="refActions">
            <button class="accent" id="addRead">+ Adicionar leitura</button>
          </div>
        </div>

        <div class="refActions">
          <button class="primary" id="saveRefs">Salvar referências</button>
          <button id="resetRefs">Voltar ao padrão</button>
        </div>
      `;

      const linksArea = wrap.querySelector("#linksArea");
      const readingArea = wrap.querySelector("#readingArea");

      function itemUI(item, idx, type){
        const el = document.createElement("div");
        el.className = "refItem";
        el.innerHTML = `
          <div class="row">
            <div>
              <div class="small"><strong>Título</strong></div>
              <input type="text" value="${(item.label||"").replaceAll('"','&quot;')}" data-k="label" data-i="${idx}" data-t="${type}" placeholder="Ex.: Vídeo (PT) – Amostragem do zero"/>
            </div>
            <div>
              <div class="small"><strong>URL</strong></div>
              <input type="url" value="${(item.url||"").replaceAll('"','&quot;')}" data-k="url" data-i="${idx}" data-t="${type}" placeholder="https://..."/>
            </div>
          </div>
          <div class="refActions">
            <button class="warn" data-del="${idx}" data-t="${type}">Remover</button>
          </div>
        `;
        return el;
      }

      current.links.forEach((it,idx)=> linksArea.appendChild(itemUI(it, idx, "links")));
      current.reading.forEach((it,idx)=> readingArea.appendChild(itemUI(it, idx, "reading")));

      // change handlers
      wrap.querySelectorAll("input").forEach(inp=>{
        inp.addEventListener("input", ()=>{
          const type = inp.dataset.t;
          const i = Number(inp.dataset.i);
          const k = inp.dataset.k;
          current[type][i][k] = inp.value;
        });
      });

      // delete handlers
      wrap.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const type = btn.dataset.t;
          const i = Number(btn.dataset.del);
          current[type].splice(i,1);
          render();
        });
      });

      wrap.querySelector("#addLink").addEventListener("click", ()=>{
        current.links.push({label:"", url:""});
        render();
      });
      wrap.querySelector("#addRead").addEventListener("click", ()=>{
        current.reading.push({label:"", url:""});
        render();
      });

      wrap.querySelector("#saveRefs").addEventListener("click", ()=>{
        state.customRefs = state.customRefs || {};
        state.customRefs[lesson.id] = {
          links: current.links,
          reading: current.reading
        };
        saveState();
        alert("Referências salvas para esta semana.");
        // reabrir para atualizar painel de materiais
        openLesson(lesson.id);
      });

      wrap.querySelector("#resetRefs").addEventListener("click", ()=>{
        if(!confirm("Voltar ao padrão desta semana? (apaga suas edições)")) return;
        if(state.customRefs?.[lesson.id]) delete state.customRefs[lesson.id];
        saveState();
        alert("Voltado ao padrão.");
        openLesson(lesson.id);
      });
    }

    render();
    return wrap;
  }

  // ==============================
  // Abrir aula
  // ==============================
  function openLesson(id){
    const base = BASE_LESSONS.find(x=>x.id===id);
    if(!base) return;
    const lesson = lessonWithCustomRefs(base);

    state.currentId = id;
    saveState();

    document.getElementById("lessonTitle").textContent = `Semana ${lesson.id} – ${lesson.short}`;
    document.getElementById("lessonDates").textContent = `Período: ${lesson.dates}`;
    document.getElementById("lessonShort").textContent = lesson.short;
    document.getElementById("lessonHint").textContent = "";

    const panels = document.getElementById("lessonPanels");
    panels.innerHTML = "";

    // Objetivos
    const obj = elHTML("details", `
      <summary>Objetivos da semana <span class="chip">o que dominar</span></summary>
      <div class="content">
        <p><strong>Ao final desta semana, você deve conseguir:</strong></p>
        ${mkList(lesson.objectives || [])}
        <div class="box ok">
          <strong>Como isso vira nota e aprendizado:</strong> o dossiê fica mais fácil quando você escreve com base nesses objetivos.
          Se você cumpriu os objetivos, a análise está “no trilho”.
        </div>
      </div>
    `);
    obj.open = true;
    panels.appendChild(obj);

    // Antes
    const before = elHTML("details", `
      <summary>${lesson.before?.title || "Antes da aula"} <span class="chip">preparação</span></summary>
      <div class="content">
        ${(lesson.before?.text||[]).map(p=>`<p>${p}</p>`).join("")}
        ${lesson.before?.steps?.length ? `<div class="box"><strong>Passo a passo:</strong>${mkList(lesson.before.steps)}</div>` : ""}
      </div>
    `);
    panels.appendChild(before);

    // Durante
    const during = elHTML("details", `
      <summary>${lesson.during?.title || "Durante a aula"} <span class="chip">explicação</span></summary>
      <div class="content">
        ${(lesson.during?.text||[]).map(p=>`<p>${p}</p>`).join("")}
        ${lesson.during?.commonMistakes?.length ? `<div class="box warn"><strong>Erros comuns (evite):</strong>${mkList(lesson.during.commonMistakes)}</div>` : ""}
        ${lesson.during?.replicaBox?.length ? `<div class="box ok"><strong>Lembrete de réplicas:</strong>${mkList(lesson.during.replicaBox)}</div>` : ""}
        <div class="box">
          <strong>Como saber se você “entendeu”:</strong>
          <ul>
            <li>Você consegue explicar com suas palavras o que o método responde?</li>
            <li>Você consegue dizer qual gráfico combina com a sua pergunta?</li>
            <li>Você consegue listar 1 limitação do seu dado?</li>
          </ul>
        </div>
      </div>
    `);
    panels.appendChild(during);

    // Depois
    const after = elHTML("details", `
      <summary>${lesson.after?.title || "Depois da aula"} <span class="chip">entrega</span></summary>
      <div class="content">
        ${(lesson.after?.text||[]).map(p=>`<p>${p}</p>`).join("")}
        ${lesson.after?.tasks?.length ? `<div class="box"><strong>Entregas da semana:</strong>${mkList(lesson.after.tasks)}</div>` : ""}
      </div>
    `);
    panels.appendChild(after);

    // Materiais
    const refs = document.createElement("details");
    refs.innerHTML = `
      <summary>Materiais (links e leitura) <span class="chip">editáveis</span></summary>
      <div class="content" id="refsContent"></div>
    `;
    panels.appendChild(refs);

    const refsContent = refs.querySelector("#refsContent");
    refsContent.innerHTML = `
      <p><strong>Links (vídeos/aulas):</strong></p>
      ${mkLinks(lesson.links)}
      <p><strong>Leituras (PDF/texto/artigo):</strong></p>
      ${mkLinks(lesson.reading)}
      <div class="box">
        <strong>Dica para o aluno:</strong> não é para consumir tudo. É para ver o suficiente para escrever a 1 lauda com clareza.
      </div>
    `;

    // Editor de refs (só aparece se modo edição ligado)
    if(state.editMode){
      const ed = document.createElement("details");
      ed.open = true;
      ed.innerHTML = `<summary>Editar referências desta semana <span class="chip">modo edição</span></summary><div class="content" id="editorMount"></div>`;
      panels.appendChild(ed);
      ed.querySelector("#editorMount").appendChild(refsEditor(base));
    }

    // Notas
    const notes = elHTML("details", `
      <summary>Notas da semana <span class="chip">rascunho do dossiê</span></summary>
      <div class="content">
        <p class="small">${lesson.notesPrompt || "Notas:"}</p>
        <textarea id="notesArea" placeholder="Escreva aqui: pergunta científica, variável Y, regra de coleta, réplicas, resultado, limitação..."></textarea>
        <p class="small">As notas ficam salvas neste navegador.</p>
      </div>
    `);
    panels.appendChild(notes);

    // Quiz
    const qb = elHTML("details", `
      <summary>Quiz da semana <span class="chip">3 questões</span></summary>
      <div class="content" id="quizMount"></div>
    `);
    panels.appendChild(qb);
    qb.querySelector("#quizMount").appendChild(quizBlock(lesson));

    // Load notes
    const area = panels.querySelector("#notesArea");
    area.value = (state.notes && state.notes[id]) ? state.notes[id] : "";

    updateDoneButtons();
  }

  function updateDoneButtons(){
    const id = state.currentId;
    const done = !!state.done?.[id];
    document.getElementById("btnDone").disabled = !id || done;
    document.getElementById("btnUndone").disabled = !id || !done;
  }

  // ==============================
  // Ações topo
  // ==============================
  document.getElementById("btnDone").addEventListener("click", ()=>{
    const id = state.currentId;
    if(!id) return;
    state.done = state.done || {};
    state.done[id] = true;
    saveState();
    renderList();
    updateDoneButtons();
  });

  document.getElementById("btnUndone").addEventListener("click", ()=>{
    const id = state.currentId;
    if(!id) return;
    state.done = state.done || {};
    delete state.done[id];
    saveState();
    renderList();
    updateDoneButtons();
  });

  document.getElementById("btnSaveNotes").addEventListener("click", ()=>{
    const id = state.currentId;
    if(!id) return alert("Selecione uma semana primeiro.");
    const ta = document.querySelector("#lessonPanels #notesArea");
    if(!ta) return;
    state.notes = state.notes || {};
    state.notes[id] = ta.value;
    saveState();
    alert("Notas salvas.");
  });

  document.getElementById("btnToggleEdit").addEventListener("click", ()=>{
    state.editMode = !state.editMode;
    saveState();
    document.getElementById("btnToggleEdit").textContent = `Editar referências: ${state.editMode ? "ON" : "OFF"}`;
    if(state.currentId) openLesson(state.currentId);
  });

  document.getElementById("btnExport").addEventListener("click", ()=>{
    const payload = {
      exportedAt: new Date().toISOString(),
      done: state.done || {},
      notes: state.notes || {},
      quiz: state.quiz || {},
      customRefs: state.customRefs || {}
    };
    const blob = new Blob([JSON.stringify(payload,null,2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "relatorio-curso.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href), 1500);
  });

  document.getElementById("btnReset").addEventListener("click", ()=>{
    if(!confirm("Tem certeza? Isso apaga progresso, notas, quizzes e referências editadas deste navegador.")) return;
    localStorage.removeItem(KEY);
    state = {currentId:null, done:{}, notes:{}, quiz:{}, editMode:false, customRefs:{}};
    document.getElementById("btnToggleEdit").textContent = "Editar referências: OFF";
    renderList();
    document.getElementById("lessonTitle").textContent = "Selecione uma semana";
    document.getElementById("lessonDates").textContent = "—";
    document.getElementById("lessonShort").textContent = "—";
    document.getElementById("lessonHint").textContent = "Clique numa semana à esquerda para ver a explicação completa e o quiz.";
    document.getElementById("lessonPanels").innerHTML = "";
    calcProgress();
    updateDoneButtons();
  });

  // ==============================
  // Init
  // ==============================
  loadState();
  document.getElementById("btnToggleEdit").textContent = `Editar referências: ${state.editMode ? "ON" : "OFF"}`;
  renderList();
  openLesson(state.currentId || 1);
</script>
</body>
</html>
