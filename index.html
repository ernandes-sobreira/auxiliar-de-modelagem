<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Curso – Estatística e Modelagem (Online)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#0b1220;
      --muted:#475569;
      --line:#e5e7eb;
      --shadow: 0 10px 22px rgba(2,6,23,.08);

      --pink:#ff006e;
      --blue:#3a86ff;
      --green:#06d6a0;
      --yellow:#ffbe0b;
      --orange:#fb5607;

      --soft:#f8fafc;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:#fff;
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      line-height:1.45;
    }
    header{
      border-bottom:1px solid var(--line);
      background:
        radial-gradient(900px 340px at 10% -10%, rgba(255,0,110,.14), transparent 55%),
        radial-gradient(900px 340px at 90% -10%, rgba(58,134,255,.14), transparent 55%),
        #fff;
    }
    .wrap{max-width:980px;margin:0 auto;padding:0 14px}
    h1{margin:0;padding:18px 0 6px;font-size:22px;letter-spacing:-.01em}
    .sub{margin:0 0 14px;color:var(--muted);font-size:13px}
    .badges{display:flex;flex-wrap:wrap;gap:8px;padding:0 0 16px}
    .badge{
      font-size:12px;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
      box-shadow: 0 4px 12px rgba(2,6,23,.04);
    }

    main{padding:14px 0 26px}
    .card{
      border:1px solid var(--line);
      border-radius:16px;
      background:#fff;
      box-shadow:var(--shadow);
      overflow:hidden;
      margin-bottom:12px;
    }
    .cardHead{
      padding:12px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .cardHead strong{font-size:14px}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap}
    button{
      border:none;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
      background:#f1f5f9;
      border:1px solid var(--line);
      color:var(--text);
    }
    button.primary{background:linear-gradient(90deg,var(--blue),var(--pink));color:#fff;border:none}
    button.accent{background:linear-gradient(90deg,var(--green),var(--yellow));border:none}
    button.warn{background:linear-gradient(90deg,var(--orange),var(--pink));color:#fff;border:none}
    button:disabled{opacity:.55;cursor:not-allowed}

    .list{padding:10px 12px}
    .lessonBtn{
      width:100%;
      text-align:left;
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px;
      cursor:pointer;
      margin:10px 0;
      transition:.12s transform ease;
    }
    .lessonBtn:hover{transform:translateY(-1px)}
    .topLine{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-weight:900;
      font-size:13px;
    }
    .dates{margin-top:4px;color:var(--muted);font-size:12px}
    .tag{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      color:#fff;
      background:linear-gradient(90deg,var(--orange),var(--pink));
      white-space:nowrap;
    }
    .tag.ok{background:linear-gradient(90deg,var(--green),var(--yellow));color:#0b1220}

    .content{padding:12px 12px 14px}
    .title{font-size:18px;margin:0 0 6px}
    .meta{color:var(--muted);font-size:12px;margin-bottom:12px}

    details{
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:#fff;
      margin:10px 0;
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      font-weight:900;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    summary::-webkit-details-marker{display:none}
    .chip{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      white-space:nowrap;
    }
    .sec{padding:0 12px 12px}
    .sec p{margin:10px 0}
    .sec ul{margin:8px 0 10px 18px}

    .box{
      border-radius:14px;
      border:1px dashed rgba(58,134,255,.35);
      background:rgba(58,134,255,.06);
      padding:10px;
      margin:10px 0;
    }
    .box.ok{
      border:1px dashed rgba(6,214,160,.45);
      background:rgba(6,214,160,.08);
    }

    textarea, input[type="text"], input[type="url"]{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      outline:none;
      font-size:13px;
      font-family:inherit;
    }
    textarea{min-height:90px;resize:vertical}

    .links a{
      color:#0b1220;
      font-weight:900;
      text-decoration:none;
      border-bottom:2px solid rgba(58,134,255,.35);
      word-break:break-word;
    }
    .linkItem{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      margin:10px 0;
      background:#fff;
    }
    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width:720px){
      .row{grid-template-columns:1fr}
    }

    .quiz{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
      margin-top:10px;
    }
    .q{border-top:1px solid var(--line);padding-top:10px;margin-top:10px}
    .q:first-child{border-top:none;padding-top:0;margin-top:0}
    .qtitle{font-weight:900;margin-bottom:6px}
    .opts label{display:block;margin:6px 0}
    .result{
      margin-top:10px;
      background:#0b1220;
      color:#e2e8f0;
      border-radius:14px;
      padding:10px;
      font-size:12px;
      white-space:pre-wrap;
      display:none;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <h1>Curso – Estatística e Modelagem (Biologia/Ecologia/Saúde)</h1>
    <p class="sub">
      Plataforma simples para acompanhar as 15 semanas. Sem artigos. Links padrão: Khan Academy (você pode editar os links por semana).
    </p>
    <div class="badges">
      <span class="badge">60h • 15 semanas • 4h/semana</span>
      <span class="badge">Online</span>
      <span class="badge">Dossiê semanal (1 lauda)</span>
      <span class="badge">Quiz curto por semana</span>
    </div>
  </div>
</header>

<main class="wrap">

  <section class="card">
    <div class="cardHead">
      <strong>Semanas (clique para abrir)</strong>
      <div class="btnRow">
        <button class="accent" id="btnExport">Exportar progresso (JSON)</button>
        <button class="warn" id="btnReset">Resetar</button>
      </div>
    </div>
    <div class="list" id="lessonList"></div>
  </section>

  <section class="card">
    <div class="cardHead">
      <strong>Conteúdo da semana selecionada</strong>
      <div class="btnRow">
        <button class="primary" id="btnDone">Marcar como concluída</button>
        <button id="btnUndone">Desmarcar</button>
      </div>
    </div>

    <div class="content">
      <h2 class="title" id="title">Selecione uma semana acima</h2>
      <div class="meta" id="meta">—</div>
      <div id="panels"></div>
    </div>
  </section>

</main>

<script>
  // ======== DADOS DO CURSO (15 SEMANAS) ========
  // Conteúdo detalhado, mas prático para 4h.
  const LESSONS = [
    {id:1,  dates:"23/02/2026 a 28/02/2026", title:"Introdução e desenho amostral"},
    {id:2,  dates:"02/03/2026 a 07/03/2026", title:"Tipos de dados e variáveis"},
    {id:3,  dates:"09/03/2026 a 14/03/2026", title:"Descrição de dados e gráficos"},
    {id:4,  dates:"16/03/2026 a 21/03/2026", title:"Probabilidade e inferência"},
    {id:5,  dates:"23/03/2026 a 28/03/2026", title:"Distribuições (normal, binomial, Poisson)"},
    {id:6,  dates:"30/03/2026 a 04/04/2026", title:"Premissas: paramétrico vs não paramétrico"},
    {id:7,  dates:"06/04/2026 a 11/04/2026", title:"Testes básicos: t, F, qui-quadrado"},
    {id:8,  dates:"13/04/2026 a 18/04/2026", title:"ANOVA (uma via) e comparações"},
    {id:9,  dates:"20/04/2026 a 25/04/2026", title:"ANOVA (duas vias) e interação"},
    {id:10, dates:"27/04/2026 a 02/05/2026", title:"Regressão linear"},
    {id:11, dates:"04/05/2026 a 09/05/2026", title:"Correlação (Pearson e Spearman)"},
    {id:12, dates:"11/05/2026 a 16/05/2026", title:"Modelos Lineares Generalizados (GLM)"},
    {id:13, dates:"18/05/2026 a 23/05/2026", title:"Modelos com múltiplos preditores"},
    {id:14, dates:"25/05/2026 a 30/05/2026", title:"ANCOVA + viés + testes cegos"},
    {id:15, dates:"01/06/2026 a 06/06/2026", title:"Projeto final: análise, escrita e apresentação"},
  ];

  // Texto “mais detalhado” por semana (didático e prático)
  function lessonText(id){
    const base = {
      objectives: [
        "Entender o que a ferramenta estatística da semana responde (qual pergunta ela resolve).",
        "Aplicar em um conjunto de dados simples (cotidiano ou internet).",
        "Produzir dossiê de 1 lauda com: pergunta, dados, gráfico e interpretação curta."
      ],
      before: [
        "Organize sua pergunta da semana em uma frase. Ela precisa virar uma tabela simples.",
        "Defina com clareza o que é uma observação (unidade amostral) e quantas réplicas você terá.",
        "Garanta que a regra de coleta é fixa (horário, duração, fonte do dado, etc.)."
      ],
      during: [
        "Você vai estudar o conceito central em partes: (1) o que é, (2) quando usar, (3) como interpretar, (4) erros comuns.",
        "O foco é leitura de gráfico + interpretação do resultado, e não decorar fórmula.",
        "A aula deve te deixar capaz de explicar o método com suas palavras, como se estivesse ensinando outra pessoa."
      ],
      after: [
        "Você entrega um dossiê curto (1 lauda). O objetivo é ser corrigível em poucos minutos.",
        "Estrutura recomendada do dossiê: Pergunta científica (1 linha) → Dados (tabela curta) → Gráfico → Resultado/Interpretação (5–8 linhas) → 1 limitação."
      ],
      replica: [
        "Lembrete: réplica é observação independente (ex.: dias diferentes), não repetir o mesmo valor várias vezes.",
        "Sem réplicas suficientes, não complique: foque em melhorar o desenho e a consistência."
      ]
    };

    // Ajustes por tema (textos extras)
    const extra = {
      1: {
        objectives: [
          "Construir pergunta científica testável e simples.",
          "Definir unidade amostral, réplicas e padronização.",
          "Planejar coleta que caiba em até 4 horas na semana."
        ],
        during: [
          "Parte 1 — Pergunta científica: tem que indicar comparação (A vs B) ou relação (Y muda com X).",
          "Parte 2 — Unidade amostral: é o ‘bloco’ de observação (ex.: 1 dia). Isso evita pseudorrepetição.",
          "Parte 3 — Réplicas: várias unidades independentes para capturar variabilidade real.",
          "Parte 4 — Padronização: regra fixa para medir/observar (se muda, você mistura efeitos).",
          "Parte 5 — Viés: medir só quando dá vontade, trocar método, escolher só um caso ‘bom’."
        ]
      },
      8: {
        during: [
          "ANOVA (1 via) responde: existe diferença entre 3 ou mais grupos?",
          "Depois de ANOVA significativa, você precisa identificar quais grupos diferem (comparações).",
          "Sempre acompanhe ANOVA com gráfico: boxplot por grupo + pontos (quando possível).",
          "Interpretação boa: fala do padrão observado + variabilidade + coerência biológica."
        ]
      },
      10: {
        during: [
          "Regressão linear modela relação entre X e Y. Você vai olhar: direção (inclinação), força (R²) e evidência (p).",
          "Ponto central: associação não é causalidade. O desenho e o contexto importam.",
          "Resíduos são essenciais: se o gráfico mostra curvatura, a linearidade pode não ser adequada."
        ]
      },
      12: {
        during: [
          "GLM entra quando o Y não se comporta como ‘normal’: contagens, proporções, muitos zeros.",
          "A ideia é ajustar um modelo mais compatível com o tipo de dado, e interpretar o efeito de forma aplicada.",
          "Nesta disciplina, você não precisa se perder em matemática: precisa reconhecer quando GLM é mais adequado."
        ]
      },
      15: {
        after: [
          "Projeto final: (1) pergunta científica clara, (2) dados e regra de coleta, (3) análise adequada, (4) gráficos, (5) interpretação e limitações.",
          "Entrega final deve incluir: base de dados (CSV), figuras (PNG) e apresentação curta (slides ou PDF)."
        ]
      }
    };

    const merged = JSON.parse(JSON.stringify(base));
    if(extra[id]){
      for(const k of Object.keys(extra[id])){
        merged[k] = extra[id][k];
      }
    }
    return merged;
  }

  // ======== LINKS (só Khan Academy por padrão; você pode editar por semana) ========
  const DEFAULT_LINKS = [
    {label:"Khan Academy (PT) – Estatística e probabilidade", url:"https://pt.khanacademy.org/math/statistics-probability"}
  ];

  // ======== ESTADO ========
  const KEY = "curso_plataforma_v3";
  let state = {
    currentId: null,
    done: {},       // {id:true}
    notes: {},      // {id:"..."}
    links: {}       // {id:[{label,url},...]}
  };

  function loadState(){
    const raw = localStorage.getItem(KEY);
    if(raw){
      try{ state = JSON.parse(raw); } catch(e){}
    }
  }
  function saveState(){
    localStorage.setItem(KEY, JSON.stringify(state));
  }

  function getLinksFor(id){
    const custom = state.links && state.links[id];
    if(Array.isArray(custom)) return custom;
    return DEFAULT_LINKS.slice();
  }

  // ======== RENDER LISTA (GARANTIDO) ========
  function renderList(){
    const list = document.getElementById("lessonList");
    list.innerHTML = "";

    for(const ls of LESSONS){
      const isDone = !!state.done[ls.id];
      const btn = document.createElement("button");
      btn.className = "lessonBtn";
      btn.innerHTML = `
        <div class="topLine">
          <span>Semana ${ls.id} • ${ls.title}</span>
          <span class="tag ${isDone ? "ok" : ""}">${isDone ? "Concluída" : "Pendente"}</span>
        </div>
        <div class="dates">${ls.dates}</div>
      `;
      btn.addEventListener("click", ()=>openLesson(ls.id));
      list.appendChild(btn);
    }
  }

  // ======== QUIZ SIMPLES ========
  function buildQuiz(id){
    // 3 perguntas genéricas (suficientes e rápidas)
    const qs = [
      {
        q:"Qual item é indispensável no dossiê semanal?",
        options:["Somente p-valor","Pergunta científica + gráfico + interpretação","Somente título","Somente média"],
        correct: 1,
        fb:["Insuficiente.","Correto.","Insuficiente.","Insuficiente."]
      },
      {
        q:"Réplica significa:",
        options:["Repetir o mesmo valor","Observações independentes (novos dias/locais)","Mudar método","Excluir variabilidade"],
        correct: 1,
        fb:["Não.","Correto.","Não.","Não."]
      },
      {
        q:"Uma boa interpretação deve sempre mencionar:",
        options:["A cor do gráfico","O padrão observado e pelo menos 1 limitação","Que ‘provou’ causalidade","Que o resultado é perfeito"],
        correct: 1,
        fb:["Não.","Correto.","Não.","Não."]
      }
    ];

    const box = document.createElement("div");
    box.className = "quiz";
    box.innerHTML = `
      <div><strong>Quiz curto (3 questões)</strong></div>
      <div class="small" style="color:#475569;margin-top:6px">
        Objetivo: reforçar o raciocínio. Não é para ser difícil.
      </div>
      <div id="qs"></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="primary" id="grade">Corrigir</button>
      </div>
      <div class="result" id="res"></div>
    `;

    const qsEl = box.querySelector("#qs");
    qs.forEach((q,qi)=>{
      const wrap = document.createElement("div");
      wrap.className = "q";
      wrap.innerHTML = `
        <div class="qtitle">${qi+1}) ${q.q}</div>
        <div class="opts">
          ${q.options.map((opt,oi)=>`
            <label><input type="radio" name="q_${id}_${qi}" value="${oi}"/> ${opt}</label>
          `).join("")}
        </div>
      `;
      qsEl.appendChild(wrap);
    });

    box.querySelector("#grade").addEventListener("click", ()=>{
      let score = 0;
      const lines = [];
      qs.forEach((q,qi)=>{
        const chosen = box.querySelector(`input[name="q_${id}_${qi}"]:checked`);
        const a = chosen ? Number(chosen.value) : null;
        const ok = (a === q.correct);
        if(ok) score++;
        const fb = (a===null) ? "Sem resposta." : q.fb[a];
        lines.push(`${qi+1}) ${ok ? "Certo" : "Errado"} – ${fb}`);
      });
      const res = box.querySelector("#res");
      res.style.display = "block";
      res.textContent = `Pontuação: ${score}/3\n\n` + lines.join("\n");
    });

    return box;
  }

  // ======== EDITOR DE LINKS (APENAS ISSO) ========
  function buildLinkEditor(id){
    const cur = getLinksFor(id).map(x=>({label:x.label||"", url:x.url||""}));

    const holder = document.createElement("div");
    holder.className = "box";
    holder.innerHTML = `
      <strong>Editar links da semana</strong>
      <div class="small" style="margin-top:6px">
        Padrão: Khan Academy (PT). Se quiser, adicione YouTube também. Sem artigos.
      </div>
      <div id="items"></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="accent" id="add">+ Adicionar link</button>
        <button class="primary" id="save">Salvar links</button>
        <button id="reset">Voltar ao padrão (Khan)</button>
      </div>
    `;

    const itemsEl = holder.querySelector("#items");

    function render(){
      itemsEl.innerHTML = "";
      cur.forEach((it,idx)=>{
        const item = document.createElement("div");
        item.className = "linkItem";
        item.innerHTML = `
          <div class="row">
            <div>
              <div class="small"><strong>Título</strong></div>
              <input type="text" value="${it.label.replaceAll('"','&quot;')}" data-i="${idx}" data-k="label" placeholder="Ex.: Khan – Amostragem"/>
            </div>
            <div>
              <div class="small"><strong>URL</strong></div>
              <input type="url" value="${it.url.replaceAll('"','&quot;')}" data-i="${idx}" data-k="url" placeholder="https://..."/>
            </div>
          </div>
          <div style="margin-top:10px">
            <button class="warn" data-del="${idx}">Remover</button>
          </div>
        `;
        itemsEl.appendChild(item);
      });

      itemsEl.querySelectorAll("input").forEach(inp=>{
        inp.addEventListener("input", ()=>{
          const i = Number(inp.dataset.i);
          const k = inp.dataset.k;
          cur[i][k] = inp.value;
        });
      });
      itemsEl.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const i = Number(btn.dataset.del);
          cur.splice(i,1);
          render();
        });
      });
    }

    render();

    holder.querySelector("#add").addEventListener("click", ()=>{
      cur.push({label:"", url:""});
      render();
    });

    holder.querySelector("#save").addEventListener("click", ()=>{
      state.links[id] = cur.filter(x=>x.label || x.url);
      saveState();
      alert("Links salvos.");
      openLesson(id);
    });

    holder.querySelector("#reset").addEventListener("click", ()=>{
      delete state.links[id];
      saveState();
      alert("Voltou para o padrão (Khan).");
      openLesson(id);
    });

    return holder;
  }

  function renderLinks(list){
    const ok = (list||[]).filter(x=>x && x.url);
    if(!ok.length){
      return `<p class="small">Sem links cadastrados.</p>`;
    }
    return `<div class="links">
      ${ok.map(x=>`<p>• <a href="${x.url}" target="_blank" rel="noopener noreferrer">${x.label || x.url}</a></p>`).join("")}
    </div>`;
  }

  // ======== ABRIR SEMANA ========
  function openLesson(id){
    state.currentId = id;
    saveState();

    const ls = LESSONS.find(x=>x.id===id);
    if(!ls) return;

    document.getElementById("title").textContent = `Semana ${ls.id} – ${ls.title}`;
    document.getElementById("meta").textContent = `Período: ${ls.dates}`;

    const t = lessonText(id);
    const links = getLinksFor(id);

    const panels = document.getElementById("panels");
    panels.innerHTML = "";

    const block = (title, chip, html, open=true)=>{
      const d = document.createElement("details");
      if(open) d.open = true;
      d.innerHTML = `
        <summary>${title} <span class="chip">${chip}</span></summary>
        <div class="sec">${html}</div>
      `;
      return d;
    };

    panels.appendChild(block("Objetivos da semana", "essencial",
      `<ul>${t.objectives.map(x=>`<li>${x}</li>`).join("")}</ul>
       <div class="box ok"><strong>Regra de ouro:</strong> nesta disciplina, “entender” = conseguir explicar com suas palavras + mostrar no gráfico.</div>`
    ));

    panels.appendChild(block("Antes da aula", "preparação",
      t.before.map(p=>`<p>${p}</p>`).join("")
    ));

    panels.appendChild(block("Durante a aula", "explicação",
      t.during.map(p=>`<p>${p}</p>`).join("") +
      `<div class="box ok"><strong>Réplica e qualidade:</strong><ul>${t.replica.map(x=>`<li>${x}</li>`).join("")}</ul></div>`
    ));

    panels.appendChild(block("Depois da aula", "entrega",
      t.after.map(p=>`<p>${p}</p>`).join("")
    , false));

    panels.appendChild(block("Links (Khan / YouTube)", "editável",
      `<p><strong>Links desta semana:</strong></p>
       ${renderLinks(links)}
       <div style="margin-top:10px"></div>`
    , false));

    // Editor (somente isso)
    const edit = document.createElement("details");
    edit.open = false;
    edit.innerHTML = `<summary>Editar links da semana <span class="chip">apenas links</span></summary><div class="sec" id="ed"></div>`;
    edit.querySelector("#ed").appendChild(buildLinkEditor(id));
    panels.appendChild(edit);

    // Notas (opcional)
    const notes = document.createElement("details");
    notes.open = false;
    notes.innerHTML = `
      <summary>Notas do aluno (rascunho do dossiê) <span class="chip">opcional</span></summary>
      <div class="sec">
        <p class="small">Se quiser, o aluno pode rascunhar aqui. Fica salvo no navegador.</p>
        <textarea id="notes" placeholder="Pergunta científica, dados, gráfico gerado, interpretação e limitação..."></textarea>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <button class="accent" id="saveNotes">Salvar notas</button>
        </div>
      </div>
    `;
    panels.appendChild(notes);

    const ta = notes.querySelector("#notes");
    ta.value = state.notes[id] || "";
    notes.querySelector("#saveNotes").addEventListener("click", ()=>{
      state.notes[id] = ta.value;
      saveState();
      alert("Notas salvas.");
    });

    // Quiz
    const quiz = document.createElement("details");
    quiz.open = false;
    quiz.innerHTML = `<summary>Quiz da semana <span class="chip">3 questões</span></summary><div class="sec" id="qm"></div>`;
    quiz.querySelector("#qm").appendChild(buildQuiz(id));
    panels.appendChild(quiz);

    updateButtons();
  }

  function updateButtons(){
    const id = state.currentId;
    const done = !!state.done[id];
    document.getElementById("btnDone").disabled = !id || done;
    document.getElementById("btnUndone").disabled = !id || !done;
  }

  // ======== BOTÕES TOPO ========
  document.getElementById("btnDone").addEventListener("click", ()=>{
    if(!state.currentId) return;
    state.done[state.currentId] = true;
    saveState();
    renderList();
    updateButtons();
  });

  document.getElementById("btnUndone").addEventListener("click", ()=>{
    if(!state.currentId) return;
    delete state.done[state.currentId];
    saveState();
    renderList();
    updateButtons();
  });

  document.getElementById("btnExport").addEventListener("click", ()=>{
    const payload = {
      exportedAt: new Date().toISOString(),
      done: state.done,
      notes: state.notes,
      links: state.links
    };
    const blob = new Blob([JSON.stringify(payload,null,2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "progresso-curso.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href), 1500);
  });

  document.getElementById("btnReset").addEventListener("click", ()=>{
    if(!confirm("Resetar tudo neste navegador?")) return;
    localStorage.removeItem(KEY);
    state = {currentId:null, done:{}, notes:{}, links:{}};
    renderList();
    document.getElementById("title").textContent = "Selecione uma semana acima";
    document.getElementById("meta").textContent = "—";
    document.getElementById("panels").innerHTML = "";
    updateButtons();
  });

  // ======== INIT (GARANTIDO) ========
  loadState();
  renderList();

  // Se não tiver semana selecionada ainda, abre a semana 1 automaticamente
  const startId = state.currentId || 1;
  openLesson(startId);
</script>
</body>
</html>
