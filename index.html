<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Curso – Estatística e Modelagem (Biologia/Ecologia/Saúde)</title>
  <style>
    :root{
      --text:#0b1220; --muted:#475569; --line:#e5e7eb; --shadow:0 10px 24px rgba(2,6,23,.08);
      --pink:#ff006e; --blue:#3a86ff; --green:#06d6a0; --yellow:#ffbe0b; --orange:#fb5607; --purple:#8338ec;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#fff;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}
    header{
      border-bottom:1px solid var(--line);
      background:
        radial-gradient(1000px 380px at 10% -10%, rgba(255,0,110,.14), transparent 55%),
        radial-gradient(1000px 380px at 90% -10%, rgba(58,134,255,.14), transparent 55%),
        radial-gradient(1000px 380px at 50% 10%, rgba(6,214,160,.08), transparent 60%),
        #fff;
    }
    .wrap{max-width:1180px;margin:0 auto;padding:0 14px}
    h1{margin:0;padding:18px 0 6px;font-size:22px;letter-spacing:-.01em}
    .sub{margin:0 0 14px;color:var(--muted);font-size:13px;max-width:1050px}
    .badges{display:flex;flex-wrap:wrap;gap:8px;padding:0 0 16px}
    .badge{font-size:12px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;box-shadow:0 4px 12px rgba(2,6,23,.04)}
    main{padding:14px 0 28px}
    .grid{display:grid;grid-template-columns:430px 1fr;gap:12px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid var(--line);border-radius:16px;background:#fff;box-shadow:var(--shadow);overflow:hidden}
    .cardHead{padding:12px;border-bottom:1px solid var(--line);display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .cardHead strong{font-size:14px}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap}
    button{border:none;border-radius:12px;padding:10px 12px;cursor:pointer;font-weight:900;background:#f1f5f9;border:1px solid var(--line);color:var(--text)}
    button.primary{background:linear-gradient(90deg,var(--blue),var(--pink));color:#fff;border:none}
    button.accent{background:linear-gradient(90deg,var(--green),var(--yellow));border:none}
    button.warn{background:linear-gradient(90deg,var(--orange),var(--pink));color:#fff;border:none}
    button:disabled{opacity:.55;cursor:not-allowed}
    .list{padding:10px 12px;max-height:72vh;overflow:auto}
    .lessonBtn{width:100%;text-align:left;background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px;cursor:pointer;margin:10px 0;transition:.12s transform ease}
    .lessonBtn:hover{transform:translateY(-1px)}
    .topLine{display:flex;justify-content:space-between;gap:10px;font-weight:900;font-size:13px}
    .dates{margin-top:4px;color:var(--muted);font-size:12px}
    .tag{font-size:11px;padding:4px 8px;border-radius:999px;color:#fff;background:linear-gradient(90deg,var(--orange),var(--pink));white-space:nowrap}
    .tag.ok{background:linear-gradient(90deg,var(--green),var(--yellow));color:#0b1220}
    .content{padding:12px 12px 14px}
    .title{font-size:18px;margin:0 0 6px}
    .meta{color:var(--muted);font-size:12px;margin-bottom:12px}
    details{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff;margin:10px 0}
    summary{list-style:none;cursor:pointer;padding:12px;font-weight:900;display:flex;justify-content:space-between;gap:10px;align-items:center}
    summary::-webkit-details-marker{display:none}
    .chip{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#fff;white-space:nowrap}
    .sec{padding:0 12px 12px}
    .sec p{margin:10px 0}
    .sec ul,.sec ol{margin:8px 0 10px 18px}
    .box{border-radius:14px;border:1px dashed rgba(58,134,255,.35);background:rgba(58,134,255,.06);padding:10px;margin:10px 0}
    .box.ok{border:1px dashed rgba(6,214,160,.45);background:rgba(6,214,160,.08)}
    .box.warn{border:1px dashed rgba(251,86,7,.45);background:rgba(251,86,7,.08)}
    .box.purple{border:1px dashed rgba(131,56,236,.45);background:rgba(131,56,236,.08)}
    .links a{color:#0b1220;font-weight:900;text-decoration:none;border-bottom:2px solid rgba(58,134,255,.35);word-break:break-word}
    .linkItem{border:1px solid var(--line);border-radius:14px;padding:10px;margin:10px 0;background:#fff}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
    input[type="text"],input[type="url"]{width:100%;border:1px solid var(--line);border-radius:12px;padding:10px;outline:none;font-size:13px;font-family:inherit}
    .quiz{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff;margin-top:10px}
    .q{border-top:1px solid var(--line);padding-top:10px;margin-top:10px}
    .q:first-child{border-top:none;padding-top:0;margin-top:0}
    .qtitle{font-weight:900;margin-bottom:6px}
    .opts label{display:block;margin:6px 0}
    .result{margin-top:10px;background:#0b1220;color:#e2e8f0;border-radius:14px;padding:10px;font-size:12px;white-space:pre-wrap;display:none}
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <h1>Curso – Estatística e Modelagem (Biologia/Ecologia/Saúde)</h1>
    <p class="sub">
      Cada semana tem um roteiro próprio: definições detalhadas, “como fazer” (PAST 4 / LibreOffice), como interpretar, erros comuns e atividade em até 4h.
      Links são apenas Khan/YouTube (editáveis por você). Salve suas notas no navegador ou no celular.
    </p>
    <div class="badges">
      <span class="badge">60h • 15 semanas • 4h/semana</span>
      <span class="badge">Online</span>
      <span class="badge">PAST 4 + LibreOffice (sem cálculo manual)</span>
      <span class="badge">Dossiê semanal (1 lauda)</span>
      <span class="badge">Quiz curto por semana</span>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">

    <section class="card">
      <div class="cardHead">
        <strong>Semanas</strong>
        <div class="btnRow">
          <button class="accent" id="btnExport">Exportar progresso (JSON)</button>
          <button class="warn" id="btnReset">Resetar</button>
        </div>
      </div>
      <div class="list" id="lessonList"></div>
    </section>

    <section class="card">
      <div class="cardHead">
        <strong>Semana selecionada</strong>
        <div class="btnRow">
          <button class="primary" id="btnDone">Marcar como concluída</button>
          <button id="btnUndone">Desmarcar</button>
        </div>
      </div>
      <div class="content">
        <h2 class="title" id="title">Selecione uma semana</h2>
        <div class="meta" id="meta">—</div>
        <div id="panels"></div>
      </div>
    </section>

  </div>
</main>

<script>
  // =======================
  // 1) SEMANAS (títulos + datas)
  // =======================
  const LESSONS = [
    {id:1,  dates:"23/02/2026 a 28/02/2026", title:"Pergunta científica + desenho amostral"},
    {id:2,  dates:"02/03/2026 a 07/03/2026", title:"Tipos de dados/variáveis + organização da tabela"},
    {id:3,  dates:"09/03/2026 a 14/03/2026", title:"Gráficos (semana exclusiva) + como escolher e interpretar"},
    {id:4,  dates:"16/03/2026 a 21/03/2026", title:"Probabilidade e inferência na prática"},
    {id:5,  dates:"23/03/2026 a 28/03/2026", title:"Distribuições (normal, binomial, Poisson) com exemplos simples"},
    {id:6,  dates:"30/03/2026 a 04/04/2026", title:"Premissas + outliers + decisão paramétrico vs não paramétrico"},
    {id:7,  dates:"06/04/2026 a 11/04/2026", title:"Teste t (2 grupos) + tamanho de efeito e interpretação"},
    {id:8,  dates:"13/04/2026 a 18/04/2026", title:"ANOVA 1 via (3+ grupos) + pós-testes (Tukey/LSD)"},
    {id:9,  dates:"20/04/2026 a 25/04/2026", title:"ANOVA 2 vias + interação"},
    {id:10, dates:"27/04/2026 a 02/05/2026", title:"Qui-quadrado (categorias) + tabelas de contingência"},
    {id:11, dates:"04/05/2026 a 09/05/2026", title:"Correlação (Pearson/Spearman) + por que não é causalidade"},
    {id:12, dates:"11/05/2026 a 16/05/2026", title:"Regressão linear + resíduos + previsões"},
    {id:13, dates:"18/05/2026 a 23/05/2026", title:"GLM (Poisson/Binomial) – contagens e proporções"},
    {id:14, dates:"25/05/2026 a 30/05/2026", title:"Multivariado + ANCOVA + viés + teste cego"},
    {id:15, dates:"01/06/2026 a 06/06/2026", title:"Projeto final: pergunta, dados, análise e apresentação"}
  ];

  // =======================
  // 2) LINKS – padrão só Khan (PT). Você edita por semana.
  // =======================
  const DEFAULT_LINKS = [
    {label:"Khan Academy (PT) – Estatística e probabilidade", url:"https://pt.khanacademy.org/math/statistics-probability"}
  ];

  // =======================
  // 3) ESTADO
  // =======================
  const KEY = "curso_plataforma_v5";
  let state = { currentId:null, done:{}, links:{} };
  function loadState(){
    const raw = localStorage.getItem(KEY);
    if(raw){ try{ state = JSON.parse(raw); } catch(e){} }
  }
  function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); }
  function getLinksFor(id){
    const custom = state.links?.[id];
    if(Array.isArray(custom)) return custom;
    return DEFAULT_LINKS.slice();
  }

  // =======================
  // 4) CONTEÚDO REALMENTE DIFERENTE POR SEMANA
  // (cada semana tem: definições, como fazer, interpretar, erros, atividade, dossiê)
  // =======================
  const COURSE = {
    1: {
      goals:[
        "Transformar uma curiosidade em pergunta científica testável.",
        "Definir variável resposta (Y), explicativa (X) ou grupos, e unidade amostral.",
        "Planejar réplicas e padronização (o que mede, como, quando)."
      ],
      definitions:[
        {term:"Pergunta científica", def:"Frase única e testável que liga uma variável resposta (Y) a um fator (X) ou comparação entre grupos. Ela define o que coletar e qual análise faz sentido."},
        {term:"Hipótese", def:"Expectativa explicável (direção do efeito) que pode ser confrontada com dados. Ex.: “Mais tempo de tela → menor tempo de sono”."},
        {term:"Unidade amostral", def:"O que conta como 1 observação independente (ex.: 1 dia; 1 pessoa; 1 evento). Sem isso, você cai em pseudorrepetição."},
        {term:"Réplica", def:"Conjunto de unidades amostrais independentes. Réplica não é repetir o mesmo número; é coletar em momentos/condições independentes."},
        {term:"Viés", def:"Desvio sistemático causado por seleção, medida ou expectativa. Ex.: coletar só quando lembra; medir com regra variável."}
      ],
      howTo:{
        title:"Como fazer (em até 4h na semana)",
        steps:[
          "Escreva 3 perguntas possíveis e escolha 1 que caiba em 7 dias.",
          "Defina Y e X (ou grupos A/B). Ex.: Y=horas de sono; X=tempo de tela.",
          "Defina unidade amostral (1 dia). Defina regra fixa: medir sempre no mesmo horário.",
          "Planeje réplicas: no mínimo 6 dias; ideal 7–10.",
          "Monte tabela: colunas = Data, Y, X, Observações (opcional)."
        ],
        dataIdeas:[
          "Sono (horas) vs tempo de tela (min) (celular).",
          "Passos do dia vs tempo sentado (celular).",
          "Temperatura do dia (app clima) vs consumo de água (copos).",
          "Humor (0–10) vs horas de estudo/treino (autorrelato padronizado)."
        ]
      },
      interpret:[
        "Uma boa leitura inicial não usa teste: ela descreve o desenho e a lógica do dado.",
        "O dossiê desta semana é sobre clareza: se a pergunta está correta, se as variáveis são mensuráveis e se existe réplica."
      ],
      mistakes:[
        "Pergunta vaga (‘o clima afeta a vida’).",
        "Sem unidade amostral definida.",
        "Réplica confundida com repetição técnica.",
        "Trocar regra de coleta no meio da semana."
      ],
      activity:"Escolha uma pergunta científica e inicie uma coleta simples com no mínimo 6 observações independentes.",
      dossier:[
        "Pergunta científica (1 linha).",
        "Y e X (ou grupos), unidade amostral e regra fixa de coleta.",
        "Tabela inicial (mín. 6 linhas).",
        "1 gráfico preliminar (mesmo simples).",
        "Limitação (1 linha)."
      ],
      quiz:[
        {q:"O que é unidade amostral?", opts:["Uma coluna da tabela","Uma observação independente (ex.: 1 dia)","O p-valor","Um outlier"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Réplica é:", opts:["Repetir o mesmo valor","Observações independentes","Excluir pontos extremos","Mudar método"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Qual pergunta é testável?", opts:["O clima muda tudo?","Temperatura do dia está associada ao meu consumo de água?","A estatística é chata?","Quero provar que…"], ans:1,
         fb:["Vaga.","Correto.","Não é análise.","Tendenciosa."]}
      ]
    },

    2: {
      goals:[
        "Reconhecer tipos de dados (categórico, contagem, contínuo, proporção).",
        "Organizar tabela corretamente: 1 linha = 1 observação.",
        "Evitar erro de unidade e de “tabela torta”."
      ],
      definitions:[
        {term:"Variável categórica", def:"Assume categorias (ex.: choveu/não; com treino/sem treino)."},
        {term:"Variável contínua", def:"Medida em escala contínua (ex.: temperatura, tempo, altura)."},
        {term:"Contagem", def:"Número de eventos (ex.: quantas vezes acordei à noite)."},
        {term:"Proporção", def:"Parte de um total (ex.: % do dia em tela)."},
        {term:"Tabelar corretamente", def:"Cada coluna é uma variável; cada linha é uma observação; unidades ficam no cabeçalho, não no valor."}
      ],
      howTo:{
        title:"Como fazer no LibreOffice/Excel (passo a passo)",
        steps:[
          "Crie colunas: Data | Y (unidade) | X (unidade) | Grupo (se houver) | Observações.",
          "Padronize unidades (minutos OU horas; mm OU cm).",
          "Não escreva ‘10 mm’ dentro da célula: deixe ‘10’ e escreva ‘(mm)’ no cabeçalho.",
          "Revise duplicatas e valores impossíveis (ex.: sono 26h).",
          "Salve CSV (Arquivo → Salvar como → .csv)."
        ]
      },
      interpret:[
        "Uma tabela bem feita é o que permite gráfico certo e teste certo.",
        "Seu dossiê deve explicar: que tipo de variável é cada coluna e por que."
      ],
      mistakes:[
        "Misturar texto e número na mesma coluna.",
        "Unidades diferentes misturadas (min e horas).",
        "Uma linha que representa ‘vários dias’ (perde réplica)."
      ],
      activity:"Reestruture sua planilha para ficar ‘analisável’. Entregue a tabela final (print ou CSV) e descreva o tipo de cada variável.",
      dossier:[
        "Pergunta científica (1 linha).",
        "Classifique Y e X (categórica/contínua/contagem/proporção).",
        "Mostre a tabela (print).",
        "Explique 2 erros que você evitou (unidade, duplicata, etc.)."
      ],
      quiz:[
        {q:"‘Choveu (sim/não)’ é variável:", opts:["Contínua","Categórica","Contagem","Proporção"], ans:1, fb:["Não.","Correto.","Não.","Não."]},
        {q:"Boa prática de unidade é:", opts:["Escrever ‘10 mm’ na célula","Colocar unidade no cabeçalho e número puro na célula","Misturar min e h","Não registrar unidade"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Cada linha da tabela deve ser:", opts:["Um grupo inteiro","Uma observação independente","Um resumo do mês","Um gráfico"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]}
      ]
    },

    3: {
      goals:[
        "Escolher o gráfico correto para a pergunta.",
        "Interpretar padrão, dispersão, sobreposição e outliers.",
        "Evitar gráficos que escondem os dados (barra como padrão)."
      ],
      definitions:[
        {term:"Gráfico de dispersão (scatter)", def:"Mostra relação X–Y. É obrigatório para correlação/regressão."},
        {term:"Boxplot", def:"Resume mediana, quartis e possíveis outliers. Ótimo para comparar grupos."},
        {term:"Histograma", def:"Mostra distribuição de um Y (assimetria, caudas, muitos zeros)."},
        {term:"Gráfico de linha (série temporal)", def:"Mostra evolução ao longo do tempo; ideal com pontos."},
        {term:"Erro padrão vs desvio padrão", def:"DP mede variabilidade dos dados; EP mede incerteza da média. Não são a mesma coisa."}
      ],
      howTo:{
        title:"Como escolher (mapa rápido)",
        steps:[
          "Comparar 2 grupos → boxplot + pontos.",
          "Comparar 3+ grupos → boxplot por grupo (depois ANOVA/Kruskal).",
          "Relação X–Y → scatter + linha de tendência.",
          "Categorias vs categorias → barras de contagem/proporção (depois qui-quadrado).",
          "Ao longo do tempo → linha com pontos."
        ]
      },
      interpret:[
        "Interpretação boa descreve: direção do efeito, dispersão, sobreposição, e se há pontos extremos.",
        "O dossiê desta semana é essencialmente ‘aprender a ler gráfico’."
      ],
      mistakes:[
        "Usar barra como padrão e esconder distribuição.",
        "Falar ‘tem diferença’ sem comentar sobre sobreposição/variabilidade.",
        "Ignorar outliers visíveis."
      ],
      activity:"Faça 2 gráficos do mesmo dado: um fraco (barra) e um bom (boxplot+ pontos ou scatter). Compare as interpretações.",
      dossier:[
        "Pergunta científica (1 linha).",
        "Gráfico ruim vs gráfico bom (2 figuras).",
        "Explique por que o bom informa melhor (5–8 linhas).",
        "1 outlier: existe? como você interpretaria?"
      ],
      quiz:[
        {q:"Para relação X–Y, o gráfico obrigatório é:", opts:["Barras","Boxplot","Dispersão (scatter)","Pizza"], ans:2,
         fb:["Não.","Não.","Correto.","Não."]},
        {q:"Boxplot é melhor para:", opts:["Somente séries temporais","Comparar grupos mostrando distribuição","Mostrar mapa","Mostrar texto"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"DP e EP:", opts:["São iguais","DP é variabilidade do dado; EP é incerteza da média","EP mede outliers","DP mede causalidade"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]}
      ]
    },

    // IMPORTANTE: para não explodir a resposta aqui, eu deixei as semanas 4–15 prontas no mesmo formato,
    // mas com texto mais enxuto. Se você quiser, eu expando cada uma para “aula de apostila” (muito mais longo).
    // Já funciona agora e cada semana tem conteúdo diferente.

    4: mkWeek4(),
    5: mkWeek5(),
    6: mkWeek6(),
    7: mkWeek7(),
    8: mkWeek8(),
    9: mkWeek9(),
    10: mkWeek10(),
    11: mkWeek11(),
    12: mkWeek12(),
    13: mkWeek13(),
    14: mkWeek14(),
    15: mkWeek15()
  };

  // =======================
  // 4b) “builders” das semanas 4–15 (cada uma DIFERENTE)
  // =======================
  function mkWeek4(){
    return {
      goals:["Entender o que é probabilidade como linguagem de incerteza.","Ler evidência sem transformar p-valor em ‘verdade’.","Distinguir ‘padrão no gráfico’ de ‘evidência robusta’."],
      definitions:[
        {term:"Probabilidade", def:"Medida de incerteza. Em ciência, ajuda a expressar o quanto um resultado é compatível com acaso sob um modelo."},
        {term:"Hipótese nula (H0)", def:"Modelo de ‘sem efeito’ (diferença = 0; relação = 0)."},
        {term:"p-valor", def:"Probabilidade de observar um resultado tão extremo quanto o obtido, assumindo H0. Não é ‘probabilidade de H0 ser verdadeira’."},
        {term:"Tamanho de efeito", def:"Magnitude do efeito (quanto muda). Pode ser mais importante que ‘significância’."}
      ],
      howTo:{title:"Como usar na prática", steps:[
        "Sempre: descreva o padrão no gráfico primeiro.",
        "Depois: use teste/modelo para quantificar evidência.",
        "Por fim: discuta importância (tamanho de efeito) e limitação (réplica/viés)."
      ]},
      interpret:["O aluno deve escrever com cautela: ‘os dados sugerem…’ em vez de ‘provou’."],
      mistakes:["Achar que p<0,05 é ‘prova’ definitiva.","Ignorar tamanho de efeito.","Não olhar gráfico."],
      activity:"Pegue seu dado e escreva duas versões de conclusão: uma errada (‘prova’) e uma correta (‘evidência sugere…’).",
      dossier:["Pergunta científica.","1 gráfico.","Explique: padrão + incerteza + tamanho de efeito (em palavras).","1 limitação."],
      quiz:[
        {q:"p-valor é:", opts:["Prova de causalidade","Compatibilidade do dado com H0","Chance de o pesquisador estar certo","O tamanho do efeito"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Antes do teste, eu devo:", opts:["Escolher pelo menor p","Olhar gráfico","Excluir outliers","Fazer média apenas"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Tamanho de efeito significa:", opts:["Quão grande é a mudança/diferença","Se deu p<0,05","Se é normal","Se é outlier"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]}
      ]
    };
  }

  function mkWeek5(){
    return {
      goals:["Reconhecer distribuição por gráfico.","Entender normal/binomial/Poisson com exemplos.","Preparar terreno para GLM."],
      definitions:[
        {term:"Normal", def:"Distribuição aproximadamente simétrica em torno da média; comum em medidas contínuas."},
        {term:"Poisson", def:"Distribuição para contagens (eventos) em intervalo fixo; muitos valores pequenos."},
        {term:"Binomial", def:"Distribuição para número de sucessos em n tentativas; base de proporções."}
      ],
      howTo:{title:"Como identificar", steps:[
        "Faça histograma de Y.",
        "Veja: simetria? caudas longas? muitos zeros?",
        "Se for contagem: suspeite Poisson; se for proporção: binomial."
      ]},
      interpret:["A escolha do teste/modelo depende do tipo de Y e do formato."],
      mistakes:["Forçar normalidade para contagem/proporção.","Usar média como único resumo em dados assimétricos."],
      activity:"Faça histograma do seu Y e descreva o formato em 6 linhas.",
      dossier:["1 histograma.","Descrição do formato.","O que isso sugere sobre o tipo de análise (em palavras)."],
      quiz:[
        {q:"Poisson é típico de:", opts:["Alturas","Contagens","Categorias","Textos"], ans:1, fb:["Não.","Correto.","Não.","Não."]},
        {q:"Binomial é típico de:", opts:["Sucesso/fracasso","Temperatura","Distância","p-valor"], ans:0, fb:["Correto.","Não.","Não.","Não."]},
        {q:"Histograma serve para:", opts:["Ver distribuição","Ver mapa","Ver causalidade","Excluir outliers"], ans:0, fb:["Correto.","Não.","Não.","Não."]}
      ]
    };
  }

  function mkWeek6(){
    return {
      goals:["Entender premissas sem decorar fórmulas.","Tratar outliers de forma científica.","Decidir paramétrico vs não paramétrico com base em gráfico."],
      definitions:[
        {term:"Normalidade (resíduos)", def:"O que deve se aproximar de normal em muitos testes é o erro/resíduo, não ‘os dados crus’ em todas as situações."},
        {term:"Homoscedasticidade", def:"Variâncias semelhantes entre grupos. Variâncias muito diferentes podem distorcer testes."},
        {term:"Outlier", def:"Valor extremo. Pode ser erro ou evento real. Nunca remover ‘para melhorar’ sem justificativa."},
        {term:"Não paramétrico", def:"Métodos menos sensíveis a pressupostos (ex.: Mann–Whitney, Kruskal–Wallis) quando apropriado."}
      ],
      howTo:{title:"Como decidir", steps:[
        "Faça boxplot/histograma e veja assimetria e extremos.",
        "Se houver outlier: investigue (unidade/erro/contexto).",
        "Se distribuição muito assimétrica e n pequeno: considere não paramétrico.",
        "Relate sempre o que foi feito com transparência."
      ]},
      interpret:["A decisão correta é justificada pelo gráfico e pelo tipo de dado."],
      mistakes:["Excluir outlier sem justificar.","Escolher teste para obter significância.","Ignorar variância desigual."],
      activity:"Escolha 1 ponto extremo no seu dado e escreva: é erro? é evento? qual impacto no resultado?",
      dossier:["Gráfico que mostra distribuição.","Discussão de outlier (1 parágrafo).","Decisão param vs não param (1 parágrafo curto)."],
      quiz:[
        {q:"Outlier eu removo quando:", opts:["Atrapa o p-valor","Tenho evidência de erro de medida/digitação","Quero normalizar","Nunca discuto"], ans:1,
         fb:["Errado.","Correto.","Errado.","Errado."]},
        {q:"Não paramétrico pode ser útil quando:", opts:["Dados muito assimétricos e n pequeno","Sempre","Quando quero p menor","Quando Y é texto"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"Premissas devem ser avaliadas com:", opts:["Achismo","Gráfico e coerência do dado","Somente média","Somente título"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]}
      ]
    };
  }

  function mkWeek7(){
    return {
      goals:["Aplicar teste t para 2 grupos com interpretação correta.","Entender diferença de médias vs importância biológica.","Usar gráfico e tamanho de efeito."],
      definitions:[
        {term:"Teste t", def:"Compara a média de dois grupos e avalia se a diferença é maior do que esperado por variação aleatória, sob premissas."},
        {term:"Tamanho de efeito (ideia)", def:"Quanto os grupos diferem em termos práticos. Mesmo com p pequeno, efeito pode ser pequeno."},
        {term:"Erro tipo I/II (ideia)", def:"Risco de falso positivo (I) e falso negativo (II)."}
      ],
      howTo:{title:"Como fazer (PAST 4)", steps:[
        "Monte tabela com colunas: Grupo (A/B) e Y.",
        "PAST: Statistics → t tests → (selecionar two-sample).",
        "Gere boxplot + pontos; compare com resultado do teste."
      ]},
      interpret:["Escreva: direção da diferença, tamanho aparente no gráfico, e cautela (não causalidade sem desenho)."],
      mistakes:["Usar teste t para 3+ grupos.","Ignorar sobreposição no boxplot.","Confundir significância com relevância."],
      activity:"Compare dois grupos do seu cotidiano (ex.: dias com treino vs sem treino) em uma variável numérica.",
      dossier:["Boxplot + pontos.","Conclusão em 6–8 linhas (diferença + variabilidade + limitação)."],
      quiz:[
        {q:"Teste t serve para:", opts:["2 grupos e Y numérico","3+ grupos","2 variáveis categóricas","Provar causalidade"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"Sempre acompanhar teste t com:", opts:["Boxplot/pontos","Somente tabela","Somente p","Nada"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"p<0,05 significa:", opts:["Efeito importante","Evidência contra H0 sob premissas","Causalidade","Sem outliers"], ans:1,
         fb:["Não necessariamente.","Correto.","Não.","Não."]}
      ]
    };
  }

  function mkWeek8(){
    return {
      goals:["Entender ANOVA 1 via como teste global.","Saber por que não fazer vários t-tests.","Aplicar pós-teste (Tukey/LSD) com cuidado."],
      definitions:[
        {term:"ANOVA 1 via", def:"Testa se existe diferença entre 3+ médias. Responde ‘existe diferença em algum lugar?’."},
        {term:"Pós-teste", def:"Comparações entre pares após ANOVA, controlando risco de falso positivo."},
        {term:"Tukey vs LSD (ideia)", def:"Tukey é mais conservador; LSD é menos conservador e exige mais cautela."}
      ],
      howTo:{title:"Como fazer (PAST 4)", steps:[
        "Tabela: Grupo (3+ níveis) e Y.",
        "PAST: Statistics → ANOVA → One-way ANOVA.",
        "Se significativo: Post hoc → Tukey (preferencial) ou LSD (com cautela).",
        "Sempre: boxplot por grupo com pontos."
      ]},
      interpret:["Relate: diferença global + quais grupos diferem + quanto diferem (pelo gráfico)."],
      mistakes:["Rodar muitos testes t para 3+ grupos.","Falar só ‘deu significativo’ sem dizer quais grupos e qual padrão."],
      activity:"Crie 3 grupos simples (ex.: manhã/tarde/noite) e compare uma variável numérica.",
      dossier:["Boxplot por grupo.","Conclusão: diferença global + quais grupos parecem diferentes + limitação."],
      quiz:[
        {q:"ANOVA 1 via responde:", opts:["Qual par difere sem pós-teste","Se existe diferença entre 3+ grupos (global)","Se é causal","Se é normal"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Pós-teste é usado para:", opts:["Criar outliers","Saber quais pares diferem","Provar causalidade","Trocar unidade"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Erro comum é:", opts:["Fazer boxplot","Fazer vários t-tests em 3+ grupos","Interpretar variabilidade","Relatar limitação"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]}
      ]
    };
  }

  function mkWeek9(){
    return {
      goals:["Entender dois fatores e interação.","Interpretar gráfico de interação.","Evitar ignorar interação."],
      definitions:[
        {term:"Fator", def:"Variável categórica que define grupos (ex.: período seco/chuvoso; com/sem treino)."},
        {term:"Interação", def:"Quando o efeito de um fator depende do nível do outro (o padrão muda)."}
      ],
      howTo:{title:"Como fazer (interpretação primeiro)", steps:[
        "Faça gráfico de médias por combinação (linhas por fator).",
        "Se linhas não paralelas → suspeite interação.",
        "Depois rode ANOVA 2 vias no PAST (se tiver desenho compatível)."
      ]},
      interpret:["A frase-chave: ‘o efeito de X muda dependendo de Z’."],
      mistakes:["Comentar só efeitos principais e ignorar interação.","Poucas réplicas por combinação."],
      activity:"Defina 2 fatores simples e veja se o padrão muda (mesmo que só como exploração).",
      dossier:["Gráfico de interação.","Explique com palavras se há mudança do efeito entre níveis."],
      quiz:[
        {q:"Interação significa:", opts:["Efeito constante","Efeito muda dependendo do outro fator","Outlier","Normalidade"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Sinal visual de interação:", opts:["Linhas paralelas","Linhas não paralelas","Barras iguais","Texto grande"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Risco na ANOVA 2 vias:", opts:["Ignorar interação","Fazer gráfico","Relatar limitação","Ter réplica"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]}
      ]
    };
  }

  function mkWeek10(){
    return {
      goals:["Usar qui-quadrado para associação entre categorias.","Montar tabela de contingência.","Interpretar com contagens/proporções."],
      definitions:[
        {term:"Tabela de contingência", def:"Matriz de contagens (ex.: 2x2) que cruza duas variáveis categóricas."},
        {term:"Qui-quadrado", def:"Testa se as frequências observadas diferem do esperado sob independência."}
      ],
      howTo:{title:"Como fazer (PAST 4)", steps:[
        "Monte contagens em uma tabela 2x2 (ou 2x3).",
        "PAST: Statistics → Contingency tables → Chi-square.",
        "Faça gráfico de barras de contagem ou proporção."
      ]},
      interpret:["Explique a associação em linguagem simples e cite limitação (amostra pequena)."],
      mistakes:["Usar com células muito baixas sem cautela.","Confundir contagem com proporção."],
      activity:"Crie duas categorias do cotidiano e conte ocorrências por 7 dias.",
      dossier:["Tabela de contingência + gráfico de barras.","Interpretação em 6 linhas."],
      quiz:[
        {q:"Qui-quadrado é para:", opts:["Duas variáveis categóricas","Dois grupos numéricos","Regressão","Normalidade"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"Entrada do qui-quadrado é:", opts:["Médias","Contagens","R²","Inclinação"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Boa prática é mostrar:", opts:["Somente p","Barras de contagem/proporção","Somente texto","Nada"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]}
      ]
    };
  }

  function mkWeek11(){
    return {
      goals:["Distinguir correlação de causalidade.","Escolher Pearson vs Spearman.","Interpretar com scatter plot."],
      definitions:[
        {term:"Correlação", def:"Medida de associação. Indica tendência conjunta, não causa."},
        {term:"Pearson", def:"Associação linear entre variáveis contínuas; sensível a outliers."},
        {term:"Spearman", def:"Associação monotônica por ranking; mais robusta a outliers."}
      ],
      howTo:{title:"Como fazer", steps:[
        "Faça scatter plot (obrigatório).",
        "Se linear e sem extremos dominantes → Pearson pode servir.",
        "Se muitos outliers/monotônico → Spearman."
      ]},
      interpret:["Escreva: direção (+/−), força (fraca/moderada/forte) e limite (não causalidade)."],
      mistakes:["Dizer ‘causa’ com correlação.","Calcular correlação sem olhar gráfico."],
      activity:"Use seu X e Y e compare Pearson vs Spearman (mesmo que só conceitualmente).",
      dossier:["Scatter plot.","Explique por que não é causalidade."],
      quiz:[
        {q:"Correlação prova causa?", opts:["Sim","Não","Só com p<0,05","Só sem outliers"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Pearson é mais adequado quando:", opts:["Linear e contínuo","Categórico","Texto","Mapa"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"Scatter plot serve para:", opts:["Ver relação X–Y","Ver contagens","Ver tabela 2x2","Ver causalidade"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]}
      ]
    };
  }

  function mkWeek12(){
    return {
      goals:["Interpretar regressão (inclinação, intercepto, R²).","Entender resíduos como diagnóstico.","Evitar extrapolação."],
      definitions:[
        {term:"Inclinação", def:"Quanto Y muda quando X aumenta 1 unidade (interpretação em unidades reais)."},
        {term:"R²", def:"Fração da variação de Y explicada pelo modelo linear (não mede causalidade)."},
        {term:"Resíduo", def:"Diferença entre valor observado e valor previsto. Padrão nos resíduos sugere modelo inadequado."}
      ],
      howTo:{title:"Como fazer (PAST 4)", steps:[
        "Scatter plot com linha ajustada.",
        "Regressão linear: Statistics → Regression → Linear regression.",
        "Observe resíduos (se disponível) ou pelo menos avalie curvatura no scatter."
      ]},
      interpret:["Escreva a inclinação em linguagem aplicada: ‘a cada +1 em X, Y muda em…’."],
      mistakes:["Extrapolar fora do intervalo.","Ignorar curvatura/outliers influentes."],
      activity:"Faça regressão Y~X com 8+ observações e escreva a interpretação da inclinação.",
      dossier:["Scatter + linha.","Interpretação da inclinação (6 linhas).","1 limitação."],
      quiz:[
        {q:"Inclinação significa:", opts:["Cor do gráfico","Mudança de Y por unidade de X","Causalidade","Outlier"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"R² mede:", opts:["Causalidade","Quanto do Y é explicado no modelo","Se é normal","Se é categórico"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Erro grave:", opts:["Interpretar inclinação","Extrapolar","Fazer scatter","Relatar limitação"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]}
      ]
    };
  }

  function mkWeek13(){
    return {
      goals:["Entender quando linear não serve.","Reconhecer contagem e proporção.","Interpretar GLM em linguagem simples (taxa/chance)."],
      definitions:[
        {term:"GLM", def:"Família de modelos para Y não-normal (ex.: contagens, proporções), com função de ligação."},
        {term:"Poisson (GLM)", def:"Modela contagens como taxa; útil quando há muitos valores pequenos."},
        {term:"Binomial (GLM)", def:"Modela proporções/sucessos; útil para sim/não ou %."}
      ],
      howTo:{title:"Como fazer (conceito + prática simples)", steps:[
        "Mostre por gráfico que Y é contagem/proporção.",
        "Explique por que regressão linear não é ideal (assimetria/limites/zeros).",
        "Se não rodar GLM, descreva qual GLM seria apropriado e como interpretaria."
      ]},
      interpret:["A interpretação muda: fala em taxa (contagem) ou chance/probabilidade (binomial)."],
      mistakes:["Aplicar GLM sem saber que dado é contagem/proporção.","Falar como se fosse inclinação linear simples."],
      activity:"Escolha um Y de contagem (ex.: número de vezes que…) ou proporção (ex.: %).",
      dossier:["Gráfico mostrando o tipo do Y.","Justificativa do GLM adequado (1 parágrafo)."],
      quiz:[
        {q:"GLM é útil quando:", opts:["Y é contagem/proporção","Y é texto","Sempre","Para p menor"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"Poisson combina com:", opts:["Contagens","Altura","Categoria pura","Mapa"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"Binomial combina com:", opts:["Sucesso/fracasso","Temperatura","R²","Intercepto"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]}
      ]
    };
  }

  function mkWeek14(){
    return {
      goals:["Entender confusão e múltiplos preditores.","Saber o que é ANCOVA.","Reconhecer viés e como reduzir (teste cego)."],
      definitions:[
        {term:"Confundidor", def:"Variável que afeta X e Y e pode gerar associação enganosa."},
        {term:"Multivariado", def:"Modelo com mais de um preditor para explicar Y."},
        {term:"ANCOVA", def:"Compara grupos ajustando por uma covariável contínua."},
        {term:"Teste cego", def:"Reduz influência de expectativa na coleta/avaliação."}
      ],
      howTo:{title:"Como aplicar (sem complicar)", steps:[
        "Identifique 1 possível confundidor no seu tema.",
        "Descreva como controlaria (na coleta) ou ajustaria (no modelo).",
        "Explique, em palavras, o que ANCOVA faria no seu caso."
      ]},
      interpret:["Boa interpretação: ‘o efeito de X permanece após controlar Z?’ (em linguagem simples)."],
      mistakes:["Adicionar variáveis para ‘dar significância’.","Ignorar confundidores óbvios."],
      activity:"Reescreva sua pergunta incluindo controle: ‘comparar A vs B controlando por Z’.",
      dossier:["Liste 1 confundidor e 1 estratégia de controle.","Explique o que seria o efeito ajustado."],
      quiz:[
        {q:"Confundidor é:", opts:["Uma variável que bagunça a interpretação por afetar X e Y","Um outlier","Um p-valor","Um gráfico"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"ANCOVA faz:", opts:["Comparar grupos ajustando por covariável","Somar médias","Excluir outliers","Provar causalidade"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]},
        {q:"Teste cego reduz:", opts:["Viés de expectativa","Réplica","Dados","Variabilidade"], ans:0,
         fb:["Correto.","Não.","Não.","Não."]}
      ]
    };
  }

  function mkWeek15(){
    return {
      goals:["Fechar um projeto profundo sem complicar.","Entregar dados + gráficos + análise + interpretação.","Apresentar com rigor e limitações."],
      definitions:[
        {term:"Discussão científica", def:"Interpretação conectada à pergunta, com explicação de mecanismos plausíveis e limitações."},
        {term:"Limitação", def:"Parte do desenho/dado que impede conclusão forte (ex.: poucas réplicas, viés, variável não medida)."}
      ],
      howTo:{title:"Como montar a entrega final", steps:[
        "Reafirme pergunta científica (1 linha) e hipótese (1 linha).",
        "Mostre tabela (CSV) e 2–4 gráficos principais.",
        "Escolha 1 análise coerente (t/ANOVA/regressão/qui²/correlação/GLM conforme seu dado).",
        "Escreva resultados em linguagem aplicada e liste limitações + próximos passos."
      ]},
      interpret:["A apresentação final vale mais quando a história é coerente: pergunta → dado → gráfico → método → interpretação."],
      mistakes:["Método sofisticado sem necessidade.","Conclusão sem limitação.","Não mostrar os dados."],
      activity:"Montar apresentação curta (5–7 slides) ou texto (1–2 páginas) com gráficos e interpretação.",
      dossier:["Entrega final substitui dossiê: CSV + figuras + apresentação."],
      quiz:[
        {q:"Projeto final profundo é:", opts:["Complicado","Coerente, bem desenhado e bem interpretado","Cheio de fórmulas","Sem gráficos"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Obrigatório na entrega:", opts:["Somente p","Dados + gráficos + interpretação","Somente texto","Somente título"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]},
        {q:"Limitação serve para:", opts:["Enfraquecer seu trabalho","Dar honestidade e orientar próximos passos","Excluir resultados","Provar causalidade"], ans:1,
         fb:["Não.","Correto.","Não.","Não."]}
      ]
    };
  }

  // =======================
  // 5) UI helpers
  // =======================
  function renderList(){
    const list = document.getElementById("lessonList");
    list.innerHTML = "";
    LESSONS.forEach(ls=>{
      const isDone = !!state.done[ls.id];
      const btn = document.createElement("button");
      btn.className="lessonBtn";
      btn.innerHTML = `
        <div class="topLine">
          <span>Semana ${ls.id} • ${ls.title}</span>
          <span class="tag ${isDone?"ok":""}">${isDone?"Concluída":"Pendente"}</span>
        </div>
        <div class="dates">${ls.dates}</div>
      `;
      btn.addEventListener("click", ()=>openLesson(ls.id));
      list.appendChild(btn);
    });
  }

  function renderLinks(list){
    const ok = (list||[]).filter(x=>x && x.url);
    if(!ok.length) return `<p style="color:#475569;font-size:12px">Sem links cadastrados.</p>`;
    return `<div class="links">${ok.map(x=>`<p>• <a href="${x.url}" target="_blank" rel="noopener noreferrer">${x.label||x.url}</a></p>`).join("")}</div>`;
  }

  function buildLinkEditor(id){
    const cur = getLinksFor(id).map(x=>({label:x.label||"", url:x.url||""}));
    const holder = document.createElement("div");
    holder.className="box";
    holder.innerHTML=`
      <strong>Editar links (Khan/YouTube)</strong>
      <div style="color:#475569;margin-top:6px;font-size:12px">
        Cole links em português. Sem artigos aqui.
      </div>
      <div id="items"></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="accent" id="add">+ Adicionar link</button>
        <button class="primary" id="save">Salvar links</button>
        <button id="reset">Voltar ao padrão (Khan)</button>
      </div>
    `;
    const itemsEl = holder.querySelector("#items");

    function rerender(){
      itemsEl.innerHTML="";
      cur.forEach((it,idx)=>{
        const item=document.createElement("div");
        item.className="linkItem";
        item.innerHTML=`
          <div class="row">
            <div>
              <div style="font-size:12px;color:#475569"><strong>Título</strong></div>
              <input type="text" value="${it.label.replaceAll('"','&quot;')}" data-i="${idx}" data-k="label" placeholder="Ex.: YouTube – ANOVA 1 via (PT)"/>
            </div>
            <div>
              <div style="font-size:12px;color:#475569"><strong>URL</strong></div>
              <input type="url" value="${it.url.replaceAll('"','&quot;')}" data-i="${idx}" data-k="url" placeholder="https://..."/>
            </div>
          </div>
          <div style="margin-top:10px"><button class="warn" data-del="${idx}">Remover</button></div>
        `;
        itemsEl.appendChild(item);
      });

      itemsEl.querySelectorAll("input").forEach(inp=>{
        inp.addEventListener("input", ()=>{
          const i=Number(inp.dataset.i), k=inp.dataset.k;
          cur[i][k]=inp.value;
        });
      });
      itemsEl.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const i=Number(btn.dataset.del);
          cur.splice(i,1);
          rerender();
        });
      });
    }
    rerender();

    holder.querySelector("#add").addEventListener("click", ()=>{cur.push({label:"",url:""});rerender();});
    holder.querySelector("#save").addEventListener("click", ()=>{
      state.links[id]=cur.filter(x=>x.label||x.url);
      saveState();
      alert("Links salvos.");
      openLesson(id);
    });
    holder.querySelector("#reset").addEventListener("click", ()=>{
      delete state.links[id];
      saveState();
      alert("Voltou ao padrão.");
      openLesson(id);
    });

    return holder;
  }

  function buildQuiz(week){
    const qs = week.quiz || [];
    const box = document.createElement("div");
    box.className="quiz";
    box.innerHTML=`
      <div><strong>Quiz curto (3 questões)</strong></div>
      <div style="color:#475569;margin-top:6px;font-size:12px">Objetivo: checar entendimento do conteúdo desta semana.</div>
      <div id="qs"></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="primary" id="grade">Corrigir</button>
      </div>
      <div class="result" id="res"></div>
    `;
    const qsEl = box.querySelector("#qs");
    qs.forEach((q,qi)=>{
      const w = document.createElement("div");
      w.className="q";
      w.innerHTML=`
        <div class="qtitle">${qi+1}) ${q.q}</div>
        <div class="opts">${q.opts.map((o,oi)=>`<label><input type="radio" name="q_${week._id}_${qi}" value="${oi}"/> ${o}</label>`).join("")}</div>
      `;
      qsEl.appendChild(w);
    });

    box.querySelector("#grade").addEventListener("click", ()=>{
      let score=0;
      const lines=[];
      qs.forEach((q,qi)=>{
        const chosen = box.querySelector(`input[name="q_${week._id}_${qi}"]:checked`);
        const a = chosen ? Number(chosen.value) : null;
        const ok = (a===q.ans);
        if(ok) score++;
        const fb = (a===null) ? "Sem resposta." : q.fb[a];
        lines.push(`${qi+1}) ${ok?"Certo":"Errado"} – ${fb}`);
      });
      const res=box.querySelector("#res");
      res.style.display="block";
      res.textContent=`Pontuação: ${score}/${qs.length}\n\n`+lines.join("\n");
    });

    return box;
  }

  function block(title, chip, html, open=false){
    const d=document.createElement("details");
    d.open=open;
    d.innerHTML=`<summary>${title} <span class="chip">${chip}</span></summary><div class="sec">${html}</div>`;
    return d;
  }

  // =======================
  // 6) OPEN WEEK (monta estrutura completa e única)
  // =======================
  function openLesson(id){
    state.currentId=id; saveState();
    const ls = LESSONS.find(x=>x.id===id);
    const week = COURSE[id];
    if(!ls || !week) return;

    document.getElementById("title").textContent = `Semana ${ls.id} – ${ls.title}`;
    document.getElementById("meta").textContent = `Período: ${ls.dates}`;

    const panels=document.getElementById("panels");
    panels.innerHTML="";

    // Goals
    panels.appendChild(block("1) O que você vai aprender", "objetivos",
      `<ul>${(week.goals||[]).map(x=>`<li>${x}</li>`).join("")}</ul>
       <div class="box ok"><strong>Nota:</strong> Salve suas notas no navegador ou no celular.</div>`, true
    ));

    // Definitions
    panels.appendChild(block("2) Definições (sem enrolação, mas completas)", "conceitos",
      `<ul>${(week.definitions||[]).map(d=>`<li><strong>${d.term}:</strong> ${d.def}</li>`).join("")}</ul>`, true
    ));

    // How-to
    if(week.howTo){
      const h = week.howTo;
      panels.appendChild(block("3) Como fazer (passo a passo)", "mão na massa",
        `<p><strong>${h.title||""}</strong></p>
         ${h.steps ? `<ol>${h.steps.map(x=>`<li>${x}</li>`).join("")}</ol>` : ""}
         ${h.dataIdeas ? `<div class="box purple"><strong>Ideias de dados simples</strong><ul>${h.dataIdeas.map(x=>`<li>${x}</li>`).join("")}</ul></div>` : ""}`,
        false
      ));
    }

    // Interpret + mistakes
    panels.appendChild(block("4) Como interpretar (o que escrever no dossiê)", "interpretação",
      (week.interpret||[]).map(p=>`<p>${p}</p>`).join(""), false
    ));

    panels.appendChild(block("5) Erros comuns desta semana (evite)", "atenção",
      `<div class="box warn"><ul>${(week.mistakes||[]).map(x=>`<li>${x}</li>`).join("")}</ul></div>`, false
    ));

    // Activity
    panels.appendChild(block("6) Atividade da semana (cabe em 4h)", "atividade",
      `<div class="box ok"><strong>Tarefa:</strong> ${week.activity||"—"}</div>`, false
    ));

    // Dossier
    panels.appendChild(block("7) Dossiê (1 lauda) – modelo desta semana", "entrega",
      `<ol>${(week.dossier||[]).map(x=>`<li>${x}</li>`).join("")}</ol>
       <div class="box"><strong>Correção rápida:</strong> eu olho se a pergunta está clara, se o gráfico responde a pergunta e se a interpretação tem 1 limitação.</div>`, false
    ));

    // Links + editor
    const links = getLinksFor(id);
    panels.appendChild(block("8) Links (Khan/YouTube)", "editável",
      `<p><strong>Links desta semana:</strong></p>${renderLinks(links)}`, false
    ));

    const ed=document.createElement("details");
    ed.open=false;
    ed.innerHTML=`<summary>Editar links da semana <span class="chip">somente links</span></summary><div class="sec" id="ed"></div>`;
    ed.querySelector("#ed").appendChild(buildLinkEditor(id));
    panels.appendChild(ed);

    // Quiz
    const q=document.createElement("details");
    q.open=false;
    week._id=id;
    q.innerHTML=`<summary>9) Quiz da semana <span class="chip">3 questões</span></summary><div class="sec" id="qm"></div>`;
    q.querySelector("#qm").appendChild(buildQuiz(week));
    panels.appendChild(q);

    updateButtons();
  }

  function updateButtons(){
    const id=state.currentId;
    const done=!!state.done[id];
    document.getElementById("btnDone").disabled=!id||done;
    document.getElementById("btnUndone").disabled=!id||!done;
  }

  // =======================
  // 7) Botões
  // =======================
  document.getElementById("btnDone").addEventListener("click", ()=>{
    if(!state.currentId) return;
    state.done[state.currentId]=true; saveState(); renderList(); updateButtons();
  });
  document.getElementById("btnUndone").addEventListener("click", ()=>{
    if(!state.currentId) return;
    delete state.done[state.currentId]; saveState(); renderList(); updateButtons();
  });
  document.getElementById("btnExport").addEventListener("click", ()=>{
    const payload={exportedAt:new Date().toISOString(), done:state.done, links:state.links};
    const blob=new Blob([JSON.stringify(payload,null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob); a.download="progresso-curso.json";
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href),1500);
  });
  document.getElementById("btnReset").addEventListener("click", ()=>{
    if(!confirm("Resetar tudo neste navegador?")) return;
    localStorage.removeItem(KEY);
    state={currentId:null, done:{}, links:{}};
    renderList();
    document.getElementById("title").textContent="Selecione uma semana";
    document.getElementById("meta").textContent="—";
    document.getElementById("panels").innerHTML="";
    updateButtons();
  });

  // =======================
  // 8) INIT
  // =======================
  loadState();
  renderList();
  openLesson(state.currentId || 1);
</script>
</body>
</html>
